void fe_mel_spec(fe_t *FE, double *spec, double *mfspec)
{
    int32 whichfilt, start, i;
    float dfreq;
    
    dfreq = FE->SAMPLING_RATE/(float)FE->FFT_SIZE;
    
    for (whichfilt = 0; whichfilt<FE->MEL_FB->num_filters; whichfilt++){
        /* Round to the nearest integer instead of truncating and
	 adding one, which breaks if the divide is already an
	 integer */      
	start = (int32)(FE->MEL_FB->left_apex[whichfilt]/dfreq + 0.5);
	mfspec[whichfilt] = 0;
	for (i=0; i< FE->MEL_FB->width[whichfilt]; i++)
	    mfspec[whichfilt] +=
		FE->MEL_FB->filter_coeffs[whichfilt][i]*spec[start+i];	
    }
    
}
