static int
calls_function_1 (exp, which)
     tree exp;
     int which;
{
  int i;
  enum tree_code code = TREE_CODE (exp);
  int class = TREE_CODE_CLASS (code);
  int length = first_rtl_op (code);

  /* If this code is language-specific, we don't know what it will do.  */
  if ((int) code >= NUM_TREE_CODES)
    return 1;

  switch (code)
    {
    case CALL_EXPR:
      if (which == 0)
	return 1;
      else if ((TREE_CODE (TREE_TYPE (TREE_TYPE (TREE_OPERAND (exp, 0))))
		== FUNCTION_TYPE)
	       && (TYPE_RETURNS_STACK_DEPRESSED
		   (TREE_TYPE (TREE_TYPE (TREE_OPERAND (exp, 0))))))
	return 1;
      else if (TREE_CODE (TREE_OPERAND (exp, 0)) == ADDR_EXPR
	       && (TREE_CODE (TREE_OPERAND (TREE_OPERAND (exp, 0), 0))
		   == FUNCTION_DECL)
	       && (special_function_p (TREE_OPERAND (TREE_OPERAND (exp, 0), 0),
				       0)
		   & ECF_MAY_BE_ALLOCA))
	return 1;

      break;

    case CONSTRUCTOR:
      {
	tree tem;

	for (tem = CONSTRUCTOR_ELTS (exp); tem != 0; tem = TREE_CHAIN (tem))
	  if (calls_function_1 (TREE_VALUE (tem), which))
	    return 1;
      }

      return 0;

    case SAVE_EXPR:
      if (SAVE_EXPR_RTL (exp) != 0)
	return 0;
      if (value_member (exp, calls_function_save_exprs))
	return 0;
      calls_function_save_exprs = tree_cons (NULL_TREE, exp,
					     calls_function_save_exprs);
      return (TREE_OPERAND (exp, 0) != 0
	      && calls_function_1 (TREE_OPERAND (exp, 0), which));

    case BLOCK:
      {
	tree local;
	tree subblock;

	for (local = BLOCK_VARS (exp); local; local = TREE_CHAIN (local))
	  if (DECL_INITIAL (local) != 0
	      && calls_function_1 (DECL_INITIAL (local), which))
	    return 1;

	for (subblock = BLOCK_SUBBLOCKS (exp);
	     subblock;
	     subblock = TREE_CHAIN (subblock))
	  if (calls_function_1 (subblock, which))
	    return 1;
      }
      return 0;

    case TREE_LIST:
      for (; exp != 0; exp = TREE_CHAIN (exp))
	if (calls_function_1 (TREE_VALUE (exp), which))
	  return 1;
      return 0;

    default:
      break;
    }

  /* Only expressions, references, and blocks can contain calls.  */
  if (! IS_EXPR_CODE_CLASS (class) && class != 'r' && class != 'b')
    return 0;

  for (i = 0; i < length; i++)
    if (TREE_OPERAND (exp, i) != 0
	&& calls_function_1 (TREE_OPERAND (exp, i), which))
      return 1;

  return 0;
}
