define float @do_pme(%struct.__sFILE* nocapture readnone %logfile, i32 %bVerbose, %struct.t_inputrec* nocapture readonly %ir, [3 x float]* nocapture readonly %x, [3 x float]* nocapture %f, float* nocapture readonly %charge, [3 x float]* nocapture readonly %box, %struct.t_commrec* %cr, %struct.t_nsborder* nocapture readonly %nsb, %struct.t_nrnb* nocapture %nrnb, [3 x float]* nocapture %vir, float %ewaldcoeff, i32 %bGatherOnly) #1 {
  %nx = alloca i32, align 4
  %ny = alloca i32, align 4
  %nz = alloca i32, align 4
  %la12 = alloca i32, align 4
  %la2 = alloca i32, align 4
  %ptr = alloca float*, align 8
  %1 = load %struct.t_fftgrid** @grid, align 8, !tbaa !2
  call void @unpack_fftgrid(%struct.t_fftgrid* %1, i32* %nx, i32* %ny, i32* %nz, i32* %la2, i32* %la12, i32 1, float** %ptr) #6
  %2 = getelementptr inbounds %struct.t_nsborder* %nsb, i64 0, i32 0
  %3 = load i32* %2, align 4, !tbaa !16
  %4 = sext i32 %3 to i64
  %5 = getelementptr inbounds %struct.t_nsborder* %nsb, i64 0, i32 7, i64 %4
  %6 = load i32* %5, align 4, !tbaa !8
  %7 = getelementptr inbounds %struct.t_inputrec* %ir, i64 0, i32 20
  %8 = load i32* %7, align 4, !tbaa !18
  %9 = getelementptr inbounds %struct.t_nsborder* %nsb, i64 0, i32 8, i64 %4
  %10 = load i32* %9, align 4, !tbaa !8
  %11 = sext i32 %10 to i64
  %12 = getelementptr inbounds [3 x float]* %x, i64 %11
  %13 = getelementptr inbounds float* %charge, i64 %11
  %14 = call %struct.t_fftgrid* @spread_on_grid(%struct.__sFILE* undef, i32 %6, i32 %8, [3 x float]* %12, float* %13, [3 x float]* %box, i32 %bGatherOnly) #8
  %15 = icmp eq i32 %bGatherOnly, 0
  br i1 %15, label %16, label %._crit_edge

._crit_edge:                                      ; preds = %0
  %.pre1 = load %struct.t_fftgrid** @grid, align 8, !tbaa !2
  br label %110

; <label>:16                                      ; preds = %0
  %17 = load i32* %7, align 4, !tbaa !18
  %18 = mul nsw i32 %17, %17
  %19 = mul nsw i32 %18, %17
  %20 = load i32* %2, align 4, !tbaa !16
  %21 = sext i32 %20 to i64
  %22 = getelementptr inbounds %struct.t_nsborder* %nsb, i64 0, i32 7, i64 %21
  %23 = load i32* %22, align 4, !tbaa !8
  %24 = mul nsw i32 %19, %23
  %25 = sitofp i32 %24 to double
  %26 = getelementptr inbounds %struct.t_nrnb* %nrnb, i64 0, i32 0, i64 81
  %27 = load double* %26, align 8, !tbaa !21
  %28 = fadd double %27, %25
  store double %28, double* %26, align 8, !tbaa !21
  %29 = getelementptr inbounds %struct.t_commrec* %cr, i64 0, i32 1
  %30 = load i32* %29, align 4, !tbaa !10
  %31 = icmp sgt i32 %30, 1
  br i1 %31, label %36, label %32

; <label>:32                                      ; preds = %16
  %33 = getelementptr inbounds %struct.t_commrec* %cr, i64 0, i32 5
  %34 = load i32* %33, align 4, !tbaa !12
  %35 = icmp sgt i32 %34, 1
  br i1 %35, label %36, label %37

; <label>:36                                      ; preds = %32, %16
  call void (i32, i8*, ...)* @fatal_error(i32 0, i8* getelementptr inbounds ([48 x i8]* @.str1, i64 0, i64 0)) #6
  br label %37

; <label>:37                                      ; preds = %36, %32
  %38 = load %struct.t_fftgrid** @grid, align 8, !tbaa !2
  call void @gmxfft3D(%struct.t_fftgrid* %38, i32 -1, %struct.t_commrec* %cr) #6
  %39 = getelementptr inbounds [3 x float]* %box, i64 0, i64 0
  %40 = load float* %39, align 4, !tbaa !6
  %41 = getelementptr inbounds [3 x float]* %box, i64 1, i64 1
  %42 = load float* %41, align 4, !tbaa !6
  %43 = getelementptr inbounds [3 x float]* %box, i64 2, i64 2
  %44 = load float* %43, align 4, !tbaa !6
  %45 = fmul float %42, %44
  %46 = getelementptr inbounds [3 x float]* %box, i64 2, i64 1
  %47 = load float* %46, align 4, !tbaa !6
  %48 = getelementptr inbounds [3 x float]* %box, i64 1, i64 2
  %49 = load float* %48, align 4, !tbaa !6
  %50 = fmul float %47, %49
  %51 = fsub float %45, %50
  %52 = fmul float %40, %51
  %53 = getelementptr inbounds [3 x float]* %box, i64 1, i64 0
  %54 = load float* %53, align 4, !tbaa !6
  %55 = getelementptr inbounds [3 x float]* %box, i64 0, i64 1
  %56 = load float* %55, align 4, !tbaa !6
  %57 = fmul float %44, %56
  %58 = getelementptr inbounds [3 x float]* %box, i64 0, i64 2
  %59 = load float* %58, align 4, !tbaa !6
  %60 = fmul float %47, %59
  %61 = fsub float %57, %60
  %62 = fmul float %54, %61
  %63 = fsub float %52, %62
  %64 = getelementptr inbounds [3 x float]* %box, i64 2, i64 0
  %65 = load float* %64, align 4, !tbaa !6
  %66 = fmul float %49, %56
  %67 = fmul float %42, %59
  %68 = fsub float %66, %67
  %69 = fmul float %65, %68
  %70 = fadd float %69, %63
  %71 = load %struct.t_fftgrid** @grid, align 8, !tbaa !2
  %72 = call float @solve_pme(%struct.t_fftgrid* %71, float %ewaldcoeff, float %70, float** getelementptr inbounds ([3 x float*]* @bsp_mod, i64 0, i64 0), [3 x float]* getelementptr inbounds ([3 x [3 x float]]* @recipbox, i64 0, i64 0), [3 x float]* %vir, %struct.t_commrec* %cr) #8
  store float %72, float* @do_pme.energy, align 4, !tbaa !6
  %73 = load i32* %nx, align 4, !tbaa !8
  %74 = load i32* %ny, align 4, !tbaa !8
  %75 = mul nsw i32 %74, %73
  %76 = load i32* %nz, align 4, !tbaa !8
  %77 = mul nsw i32 %75, %76
  %78 = sitofp i32 %77 to double
  %79 = fmul double %78, 5.000000e-01
  %80 = getelementptr inbounds %struct.t_nrnb* %nrnb, i64 0, i32 0, i64 86
  %81 = load double* %80, align 8, !tbaa !21
  %82 = fadd double %81, %79
  store double %82, double* %80, align 8, !tbaa !21
  %83 = load %struct.t_fftgrid** @grid, align 8, !tbaa !2
  call void @gmxfft3D(%struct.t_fftgrid* %83, i32 1, %struct.t_commrec* %cr) #6
  %84 = load i32* %29, align 4, !tbaa !10
  %85 = icmp sgt i32 %84, 1
  br i1 %85, label %90, label %86

; <label>:86                                      ; preds = %37
  %87 = getelementptr inbounds %struct.t_commrec* %cr, i64 0, i32 5
  %88 = load i32* %87, align 4, !tbaa !12
  %89 = icmp sgt i32 %88, 1
  br i1 %89, label %90, label %91

; <label>:90                                      ; preds = %86, %37
  call void (i32, i8*, ...)* @fatal_error(i32 0, i8* getelementptr inbounds ([48 x i8]* @.str1, i64 0, i64 0)) #6
  %.pre = load i32* %29, align 4, !tbaa !10
  br label %91

; <label>:91                                      ; preds = %90, %86
  %92 = phi i32 [ %.pre, %90 ], [ %84, %86 ]
  %93 = load %struct.t_fftgrid** @grid, align 8, !tbaa !2
  %94 = getelementptr inbounds %struct.t_fftgrid* %93, i64 0, i32 11
  %95 = load i32* %94, align 4, !tbaa !23
  %96 = sitofp i32 %95 to double
  %97 = sitofp i32 %95 to float
  %98 = fpext float %97 to double
  %99 = call double @log(double %98) #7
  %100 = fmul double %96, %99
  %101 = sitofp i32 %92 to double
  %102 = fmul double %101, 0x3FE62E42FEFA39EF
  %103 = fdiv double %100, %102
  %104 = fptosi double %103 to i32
  %105 = shl nsw i32 %104, 1
  %106 = sitofp i32 %105 to double
  %107 = getelementptr inbounds %struct.t_nrnb* %nrnb, i64 0, i32 0, i64 84
  %108 = load double* %107, align 8, !tbaa !21
  %109 = fadd double %108, %106
  store double %109, double* %107, align 8, !tbaa !21
  br label %110

; <label>:110                                     ; preds = %._crit_edge, %91
  %111 = phi %struct.t_fftgrid* [ %.pre1, %._crit_edge ], [ %93, %91 ]
  %112 = load [3 x i32]** @idx, align 8, !tbaa !2
  %113 = load i32* %2, align 4, !tbaa !16
  %114 = sext i32 %113 to i64
  %115 = getelementptr inbounds %struct.t_nsborder* %nsb, i64 0, i32 8, i64 %114
  %116 = load i32* %115, align 4, !tbaa !8
  %117 = sext i32 %116 to i64
  %118 = getelementptr inbounds [3 x float]* %f, i64 %117
  %119 = getelementptr inbounds float* %charge, i64 %117
  %120 = getelementptr inbounds %struct.t_nsborder* %nsb, i64 0, i32 7, i64 %114
  %121 = load i32* %120, align 4, !tbaa !8
  %122 = load i32* %7, align 4, !tbaa !18
  %123 = load i32** @nnx, align 8, !tbaa !2
  %124 = load i32** @nny, align 8, !tbaa !2
  %125 = load i32** @nnz, align 8, !tbaa !2
  call void @gather_f_bsplines(%struct.t_fftgrid* %111, [3 x float]* getelementptr inbounds ([3 x [3 x float]]* @recipbox, i64 0, i64 0), [3 x i32]* %112, [3 x float]* %118, float* %119, float** getelementptr inbounds ([3 x float*]* @theta, i64 0, i64 0), float** getelementptr inbounds ([3 x float*]* @dtheta, i64 0, i64 0), i32 %121, i32 %122, i32* %123, i32* %124, i32* %125) #8
  %126 = load i32* %7, align 4, !tbaa !18
  %127 = mul nsw i32 %126, %126
  %128 = mul nsw i32 %127, %126
  %129 = load i32* %2, align 4, !tbaa !16
  %130 = sext i32 %129 to i64
  %131 = getelementptr inbounds %struct.t_nsborder* %nsb, i64 0, i32 7, i64 %130
  %132 = load i32* %131, align 4, !tbaa !8
  %133 = mul nsw i32 %128, %132
  %134 = sitofp i32 %133 to double
  %135 = getelementptr inbounds %struct.t_nrnb* %nrnb, i64 0, i32 0, i64 83
  %136 = load double* %135, align 8, !tbaa !21
  %137 = fadd double %136, %134
  store double %137, double* %135, align 8, !tbaa !21
  %138 = load float* @do_pme.energy, align 4, !tbaa !6
  ret float %138
}
