define float @ps_gather_f(%struct._IO_FILE* nocapture %log, i32 %bVerbose, i32 %natoms, [3 x float]* %x, [3 x float]* nocapture %f, float* nocapture %charge, float* %box, float* nocapture %pot, %struct.t_PSgrid* %grid, float* nocapture %beta, %struct.t_nrnb* nocapture %nrnb) #0 {
entry:
  %ixyz = alloca [3 x i32], align 4
  %invh = alloca [3 x float], align 4
  %c1 = alloca [3 x float], align 4
  %c2 = alloca [3 x float], align 4
  %WXYZ = alloca [27 x float], align 16
  %ixw = alloca [7 x i32], align 16
  %iyw = alloca [7 x i32], align 16
  %izw = alloca [7 x i32], align 16
  %nx = alloca i32, align 4
  %ny = alloca i32, align 4
  %nz = alloca i32, align 4
  %ptr = alloca float***, align 8
  %0 = bitcast [27 x float]* %WXYZ to i8*
  call void @llvm.lifetime.start(i64 108, i8* %0) #1
  call void @unpack_PSgrid(%struct.t_PSgrid* %grid, i32* %nx, i32* %ny, i32* %nz, float**** %ptr) #4
  %1 = load i32* %nx, align 4, !tbaa !0
  %2 = load i32* %ny, align 4, !tbaa !0
  %3 = load i32* %nz, align 4, !tbaa !0
  %arraydecay = getelementptr inbounds [3 x float]* %invh, i64 0, i64 0
  %conv.i = sitofp i32 %1 to float
  %4 = load float* %box, align 4, !tbaa !3
  %div.i = fdiv float %conv.i, %4
  store float %div.i, float* %arraydecay, align 4, !tbaa !3
  %conv2.i = sitofp i32 %2 to float
  %arrayidx3.i = getelementptr inbounds float* %box, i64 1
  %5 = load float* %arrayidx3.i, align 4, !tbaa !3
  %div4.i = fdiv float %conv2.i, %5
  %arrayidx5.i = getelementptr inbounds [3 x float]* %invh, i64 0, i64 1
  store float %div4.i, float* %arrayidx5.i, align 4, !tbaa !3
  %conv6.i = sitofp i32 %3 to float
  %arrayidx7.i = getelementptr inbounds float* %box, i64 2
  %6 = load float* %arrayidx7.i, align 4, !tbaa !3
  %div8.i = fdiv float %conv6.i, %6
  %arrayidx9.i = getelementptr inbounds [3 x float]* %invh, i64 0, i64 2
  store float %div8.i, float* %arrayidx9.i, align 4, !tbaa !3
  br label %for.body

for.body:                                         ; preds = %for.body.for.body_crit_edge, %entry
  %7 = phi float [ %div.i, %entry ], [ %.pre, %for.body.for.body_crit_edge ]
  %indvars.iv220 = phi i64 [ 0, %entry ], [ %indvars.iv.next221, %for.body.for.body_crit_edge ]
  %arrayidx = getelementptr inbounds float* %beta, i64 %indvars.iv220
  %8 = load float* %arrayidx, align 4, !tbaa !3
  %conv = fpext float %8 to double
  %div = fmul double %conv, 5.000000e-01
  %conv4 = fpext float %7 to double
  %mul = fmul double %div, %conv4
  %conv5 = fptrunc double %mul to float
  %arrayidx7 = getelementptr inbounds [3 x float]* %c1, i64 0, i64 %indvars.iv220
  store float %conv5, float* %arrayidx7, align 4, !tbaa !3
  %sub = fsub double 1.000000e+00, %conv
  %div11 = fmul double %sub, 2.500000e-01
  %mul15 = fmul double %conv4, %div11
  %conv16 = fptrunc double %mul15 to float
  %arrayidx18 = getelementptr inbounds [3 x float]* %c2, i64 0, i64 %indvars.iv220
  store float %conv16, float* %arrayidx18, align 4, !tbaa !3
  %indvars.iv.next221 = add i64 %indvars.iv220, 1
  %lftr.wideiv222 = trunc i64 %indvars.iv.next221 to i32
  %exitcond223 = icmp eq i32 %lftr.wideiv222, 3
  br i1 %exitcond223, label %for.end, label %for.body.for.body_crit_edge

for.body.for.body_crit_edge:                      ; preds = %for.body
  %arrayidx3.phi.trans.insert = getelementptr inbounds [3 x float]* %invh, i64 0, i64 %indvars.iv.next221
  %.pre = load float* %arrayidx3.phi.trans.insert, align 4, !tbaa !3
  br label %for.body

for.end:                                          ; preds = %for.body
  %ixw202 = bitcast [7 x i32]* %ixw to i8*
  %iyw205 = bitcast [7 x i32]* %iyw to i8*
  %izw209 = bitcast [7 x i32]* %izw to i8*
  %arrayidx19 = getelementptr inbounds [3 x float]* %c1, i64 0, i64 0
  %9 = load float* %arrayidx19, align 4, !tbaa !3
  %arrayidx20 = getelementptr inbounds [3 x float]* %c1, i64 0, i64 1
  %10 = load float* %arrayidx20, align 4, !tbaa !3
  %arrayidx21 = getelementptr inbounds [3 x float]* %c1, i64 0, i64 2
  %11 = load float* %arrayidx21, align 4, !tbaa !3
  %arrayidx22 = getelementptr inbounds [3 x float]* %c2, i64 0, i64 0
  %12 = load float* %arrayidx22, align 4, !tbaa !3
  %arrayidx23 = getelementptr inbounds [3 x float]* %c2, i64 0, i64 1
  %13 = load float* %arrayidx23, align 4, !tbaa !3
  %arrayidx24 = getelementptr inbounds [3 x float]* %c2, i64 0, i64 2
  %14 = load float* %arrayidx24, align 4, !tbaa !3
  %.b = load i1* @ps_gather_f.bFirst, align 1
  br i1 %.b, label %for.cond76.preheader, label %if.then

if.then:                                          ; preds = %for.end
  %call = call i32 (%struct._IO_FILE*, i8*, ...)* @fprintf(%struct._IO_FILE* %log, i8* getelementptr inbounds ([57 x i8]* @.str, i64 0, i64 0), i32 %1, i32 %2, i32 %3) #4
  %15 = load float* %beta, align 4, !tbaa !3
  %conv26 = fpext float %15 to double
  %arrayidx27 = getelementptr inbounds float* %beta, i64 1
  %16 = load float* %arrayidx27, align 4, !tbaa !3
  %conv28 = fpext float %16 to double
  %arrayidx29 = getelementptr inbounds float* %beta, i64 2
  %17 = load float* %arrayidx29, align 4, !tbaa !3
  %conv30 = fpext float %17 to double
  %call31 = call i32 (%struct._IO_FILE*, i8*, ...)* @fprintf(%struct._IO_FILE* %log, i8* getelementptr inbounds ([23 x i8]* @.str1, i64 0, i64 0), double %conv26, double %conv28, double %conv30) #4
  %conv33 = fpext float %9 to double
  %conv35 = fpext float %10 to double
  %conv37 = fpext float %11 to double
  %call38 = call i32 (%struct._IO_FILE*, i8*, ...)* @fprintf(%struct._IO_FILE* %log, i8* getelementptr inbounds ([23 x i8]* @.str2, i64 0, i64 0), double %conv33, double %conv35, double %conv37) #4
  %conv40 = fpext float %12 to double
  %conv42 = fpext float %13 to double
  %conv44 = fpext float %14 to double
  %call45 = call i32 (%struct._IO_FILE*, i8*, ...)* @fprintf(%struct._IO_FILE* %log, i8* getelementptr inbounds ([23 x i8]* @.str3, i64 0, i64 0), double %conv40, double %conv42, double %conv44) #4
  %18 = load float* %arraydecay, align 4, !tbaa !3
  %conv47 = fpext float %18 to double
  %19 = load float* %arrayidx5.i, align 4, !tbaa !3
  %conv49 = fpext float %19 to double
  %20 = load float* %arrayidx9.i, align 4, !tbaa !3
  %conv51 = fpext float %20 to double
  %call52 = call i32 (%struct._IO_FILE*, i8*, ...)* @fprintf(%struct._IO_FILE* %log, i8* getelementptr inbounds ([23 x i8]* @.str4, i64 0, i64 0), double %conv47, double %conv49, double %conv51) #4
  %21 = load i32* %nx, align 4, !tbaa !0
  %22 = load i32* %ny, align 4, !tbaa !0
  %23 = load i32* %nz, align 4, !tbaa !0
  call void @calc_nxyz(i32 %21, i32 %22, i32 %23, i32** @ps_gather_f.nnx, i32** @ps_gather_f.nny, i32** @ps_gather_f.nnz) #4
  br label %for.body56

for.body56:                                       ; preds = %for.body56, %if.then
  %indvars.iv213 = phi i64 [ 0, %if.then ], [ %indvars.iv.next214, %for.body56 ]
  %24 = trunc i64 %indvars.iv213 to i32
  %div57 = sdiv i32 %24, 9
  %add = add nsw i32 %div57, 2
  %25 = mul nsw i64 %indvars.iv213, 3
  %arrayidx60 = getelementptr inbounds [81 x i32]* @ps_gather_f.JCXYZ, i64 0, i64 %25
  store i32 %add, i32* %arrayidx60, align 4, !tbaa !0
  %div61 = sdiv i32 %24, 3
  %rem = srem i32 %div61, 3
  %add62 = add nsw i32 %rem, 2
  %26 = add nsw i64 %25, 1
  %arrayidx66 = getelementptr inbounds [81 x i32]* @ps_gather_f.JCXYZ, i64 0, i64 %26
  store i32 %add62, i32* %arrayidx66, align 4, !tbaa !0
  %rem67 = srem i32 %24, 3
  %add68 = add nsw i32 %rem67, 2
  %27 = add nsw i64 %25, 2
  %arrayidx72 = getelementptr inbounds [81 x i32]* @ps_gather_f.JCXYZ, i64 0, i64 %27
  store i32 %add68, i32* %arrayidx72, align 4, !tbaa !0
  %indvars.iv.next214 = add i64 %indvars.iv213, 1
  %lftr.wideiv218 = trunc i64 %indvars.iv.next214 to i32
  %exitcond219 = icmp eq i32 %lftr.wideiv218, 27
  br i1 %exitcond219, label %for.end75, label %for.body56

for.end75:                                        ; preds = %for.body56
  store i1 true, i1* @ps_gather_f.bFirst, align 1
  br label %for.cond76.preheader

for.cond76.preheader:                             ; preds = %for.end, %for.end75
  %cmp77190 = icmp sgt i32 %natoms, 0
  br i1 %cmp77190, label %for.body79.lr.ph, label %for.end133

for.body79.lr.ph:                                 ; preds = %for.cond76.preheader
  %arraydecay84 = getelementptr inbounds [3 x i32]* %ixyz, i64 0, i64 0
  %arraydecay85 = getelementptr inbounds [27 x float]* %WXYZ, i64 0, i64 0
  %arrayidx98 = getelementptr inbounds [3 x i32]* %ixyz, i64 0, i64 1
  %arrayidx106 = getelementptr inbounds [3 x i32]* %ixyz, i64 0, i64 2
  %arraydecay120 = getelementptr inbounds [7 x i32]* %ixw, i64 0, i64 0
  %arraydecay121 = getelementptr inbounds [7 x i32]* %iyw, i64 0, i64 0
  %arraydecay122 = getelementptr inbounds [7 x i32]* %izw, i64 0, i64 0
  br label %for.body79

for.body79:                                       ; preds = %for.body79, %for.body79.lr.ph
  %indvars.iv = phi i64 [ 0, %for.body79.lr.ph ], [ %indvars.iv.next, %for.body79 ]
  %energy.0191 = phi float [ 0.000000e+00, %for.body79.lr.ph ], [ %add128, %for.body79 ]
  %28 = load i32* %nx, align 4, !tbaa !0
  %29 = load i32* %ny, align 4, !tbaa !0
  %30 = load i32* %nz, align 4, !tbaa !0
  %arraydecay82 = getelementptr inbounds [3 x float]* %x, i64 %indvars.iv, i64 0
  %31 = trunc i64 %indvars.iv to i32
  call void @calc_weights(i32 %31, i32 %28, i32 %29, i32 %30, float* %arraydecay82, float* %box, float* %arraydecay, i32* %arraydecay84, float* %arraydecay85) #4
  %32 = load i32* %arraydecay84, align 4, !tbaa !0
  %33 = load i32* %nx, align 4, !tbaa !0
  %34 = load i32** @ps_gather_f.nnx, align 8, !tbaa !4
  %35 = load i32* %arrayidx98, align 4, !tbaa !0
  %36 = load i32* %ny, align 4, !tbaa !0
  %37 = load i32** @ps_gather_f.nny, align 8, !tbaa !4
  %38 = load i32* %arrayidx106, align 4, !tbaa !0
  %39 = load i32* %nz, align 4, !tbaa !0
  %40 = load i32** @ps_gather_f.nnz, align 8, !tbaa !4
  %41 = sext i32 %32 to i64
  %42 = sext i32 %33 to i64
  %43 = add i64 %41, %42
  %scevgep.sum = add i64 %43, -3
  %scevgep203 = getelementptr i32* %34, i64 %scevgep.sum
  %scevgep203204 = bitcast i32* %scevgep203 to i8*
  call void @llvm.memcpy.p0i8.p0i8.i64(i8* %ixw202, i8* %scevgep203204, i64 28, i32 4, i1 false)
  %44 = sext i32 %35 to i64
  %45 = sext i32 %36 to i64
  %46 = add i64 %44, %45
  %scevgep206.sum = add i64 %46, -3
  %scevgep207 = getelementptr i32* %37, i64 %scevgep206.sum
  %scevgep207208 = bitcast i32* %scevgep207 to i8*
  call void @llvm.memcpy.p0i8.p0i8.i64(i8* %iyw205, i8* %scevgep207208, i64 28, i32 4, i1 false)
  %47 = sext i32 %38 to i64
  %48 = sext i32 %39 to i64
  %49 = add i64 %47, %48
  %scevgep210.sum = add i64 %49, -3
  %scevgep211 = getelementptr i32* %40, i64 %scevgep210.sum
  %scevgep211212 = bitcast i32* %scevgep211 to i8*
  call void @llvm.memcpy.p0i8.p0i8.i64(i8* %izw209, i8* %scevgep211212, i64 28, i32 4, i1 false)
  %arrayidx118 = getelementptr inbounds float* %charge, i64 %indvars.iv
  %50 = load float* %arrayidx118, align 4, !tbaa !3
  %arraydecay125 = getelementptr inbounds [3 x float]* %f, i64 %indvars.iv, i64 0
  %51 = load float**** %ptr, align 8, !tbaa !4
  %call126 = call float @ps_gather_inner(i32* getelementptr inbounds ([81 x i32]* @ps_gather_f.JCXYZ, i64 0, i64 0), float* %arraydecay85, i32* %arraydecay120, i32* %arraydecay121, i32* %arraydecay122, float %9, float %10, float %11, float %12, float %13, float %14, float %50, float* %arraydecay125, float*** %51) #5
  %mul127 = fmul float %50, %call126
  %add128 = fadd float %energy.0191, %mul127
  %arrayidx130 = getelementptr inbounds float* %pot, i64 %indvars.iv
  store float %call126, float* %arrayidx130, align 4, !tbaa !3
  %indvars.iv.next = add i64 %indvars.iv, 1
  %lftr.wideiv = trunc i64 %indvars.iv.next to i32
  %exitcond = icmp eq i32 %lftr.wideiv, %natoms
  br i1 %exitcond, label %for.cond76.for.end133_crit_edge, label %for.body79

for.cond76.for.end133_crit_edge:                  ; preds = %for.body79
  %phitmp = fmul float %add128, 5.000000e-01
  br label %for.end133

for.end133:                                       ; preds = %for.cond76.for.end133_crit_edge, %for.cond76.preheader
  %energy.0.lcssa = phi float [ %phitmp, %for.cond76.for.end133_crit_edge ], [ 0.000000e+00, %for.cond76.preheader ]
  %mul134 = mul nsw i32 %natoms, 27
  %conv135 = sitofp i32 %mul134 to double
  %arrayidx136 = getelementptr inbounds %struct.t_nrnb* %nrnb, i64 0, i32 0, i64 82
  %52 = load double* %arrayidx136, align 8, !tbaa !5
  %add137 = fadd double %conv135, %52
  store double %add137, double* %arrayidx136, align 8, !tbaa !5
  %mul138 = mul nsw i32 %natoms, 3
  %conv139 = sitofp i32 %mul138 to double
  %arrayidx141 = getelementptr inbounds %struct.t_nrnb* %nrnb, i64 0, i32 0, i64 79
  %53 = load double* %arrayidx141, align 8, !tbaa !5
  %add142 = fadd double %conv139, %53
  store double %add142, double* %arrayidx141, align 8, !tbaa !5
  call void @llvm.lifetime.end(i64 108, i8* %0) #1
  ret float %energy.0.lcssa
}
