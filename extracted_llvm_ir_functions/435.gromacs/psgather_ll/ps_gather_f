define float @ps_gather_f(%struct.__sFILE* nocapture %log, i32 %bVerbose, i32 %natoms, [3 x float]* %x, [3 x float]* nocapture %f, float* nocapture readonly %charge, float* %box, float* nocapture %pot, %struct.t_PSgrid* %grid, float* nocapture readonly %beta, %struct.t_nrnb* nocapture %nrnb) #3 {
  %ixyz = alloca [3 x i32], align 4
  %invh = alloca [3 x float], align 4
  %c1 = alloca [3 x float], align 4
  %c2 = alloca [3 x float], align 4
  %WXYZ = alloca [27 x float], align 16
  %ixw = alloca [7 x i32], align 16
  %iyw = alloca [7 x i32], align 16
  %izw = alloca [7 x i32], align 16
  %nx = alloca i32, align 4
  %ny = alloca i32, align 4
  %nz = alloca i32, align 4
  %ptr = alloca float***, align 8
  %1 = bitcast [27 x float]* %WXYZ to i8*
  call void @llvm.lifetime.start(i64 108, i8* %1) #4
  call void @unpack_PSgrid(%struct.t_PSgrid* %grid, i32* %nx, i32* %ny, i32* %nz, float**** %ptr) #6
  %2 = load i32* %nx, align 4, !tbaa !14
  %3 = load i32* %ny, align 4, !tbaa !14
  %4 = load i32* %nz, align 4, !tbaa !14
  %5 = getelementptr inbounds [3 x float]* %invh, i64 0, i64 0
  %6 = sitofp i32 %2 to float
  %7 = load float* %box, align 4, !tbaa !15
  %8 = fdiv float %6, %7
  store float %8, float* %5, align 4, !tbaa !15
  %9 = sitofp i32 %3 to float
  %10 = getelementptr inbounds float* %box, i64 1
  %11 = load float* %10, align 4, !tbaa !15
  %12 = fdiv float %9, %11
  %13 = getelementptr inbounds [3 x float]* %invh, i64 0, i64 1
  store float %12, float* %13, align 4, !tbaa !15
  %14 = sitofp i32 %4 to float
  %15 = getelementptr inbounds float* %box, i64 2
  %16 = load float* %15, align 4, !tbaa !15
  %17 = fdiv float %14, %16
  %18 = getelementptr inbounds [3 x float]* %invh, i64 0, i64 2
  store float %17, float* %18, align 4, !tbaa !15
  br label %19

; <label>:19                                      ; preds = %._crit_edge23, %0
  %20 = phi float [ %8, %0 ], [ %.pre, %._crit_edge23 ]
  %indvars.iv20 = phi i64 [ 0, %0 ], [ %indvars.iv.next21, %._crit_edge23 ]
  %21 = getelementptr inbounds float* %beta, i64 %indvars.iv20
  %22 = load float* %21, align 4, !tbaa !15
  %23 = fpext float %22 to double
  %24 = fmul double %23, 5.000000e-01
  %25 = fpext float %20 to double
  %26 = fmul double %24, %25
  %27 = fptrunc double %26 to float
  %28 = getelementptr inbounds [3 x float]* %c1, i64 0, i64 %indvars.iv20
  store float %27, float* %28, align 4, !tbaa !15
  %29 = fsub double 1.000000e+00, %23
  %30 = fmul double %29, 2.500000e-01
  %31 = fmul double %25, %30
  %32 = fptrunc double %31 to float
  %33 = getelementptr inbounds [3 x float]* %c2, i64 0, i64 %indvars.iv20
  store float %32, float* %33, align 4, !tbaa !15
  %indvars.iv.next21 = add nuw nsw i64 %indvars.iv20, 1
  %exitcond22 = icmp eq i64 %indvars.iv.next21, 3
  br i1 %exitcond22, label %34, label %._crit_edge23

._crit_edge23:                                    ; preds = %19
  %.phi.trans.insert = getelementptr inbounds [3 x float]* %invh, i64 0, i64 %indvars.iv.next21
  %.pre = load float* %.phi.trans.insert, align 4, !tbaa !15
  br label %19

; <label>:34                                      ; preds = %19
  %ixw6 = bitcast [7 x i32]* %ixw to i8*
  %iyw9 = bitcast [7 x i32]* %iyw to i8*
  %izw13 = bitcast [7 x i32]* %izw to i8*
  %35 = getelementptr inbounds [3 x float]* %c1, i64 0, i64 0
  %36 = load float* %35, align 4, !tbaa !15
  %37 = getelementptr inbounds [3 x float]* %c1, i64 0, i64 1
  %38 = load float* %37, align 4, !tbaa !15
  %39 = getelementptr inbounds [3 x float]* %c1, i64 0, i64 2
  %40 = load float* %39, align 4, !tbaa !15
  %41 = getelementptr inbounds [3 x float]* %c2, i64 0, i64 0
  %42 = load float* %41, align 4, !tbaa !15
  %43 = getelementptr inbounds [3 x float]* %c2, i64 0, i64 1
  %44 = load float* %43, align 4, !tbaa !15
  %45 = getelementptr inbounds [3 x float]* %c2, i64 0, i64 2
  %46 = load float* %45, align 4, !tbaa !15
  %.b = load i1* @ps_gather_f.bFirst, align 1
  br i1 %.b, label %.preheader, label %47

; <label>:47                                      ; preds = %34
  %48 = call i32 (%struct.__sFILE*, i8*, ...)* @fprintf(%struct.__sFILE* %log, i8* getelementptr inbounds ([57 x i8]* @.str, i64 0, i64 0), i32 %2, i32 %3, i32 %4) #6
  %49 = load float* %beta, align 4, !tbaa !15
  %50 = fpext float %49 to double
  %51 = getelementptr inbounds float* %beta, i64 1
  %52 = load float* %51, align 4, !tbaa !15
  %53 = fpext float %52 to double
  %54 = getelementptr inbounds float* %beta, i64 2
  %55 = load float* %54, align 4, !tbaa !15
  %56 = fpext float %55 to double
  %57 = call i32 (%struct.__sFILE*, i8*, ...)* @fprintf(%struct.__sFILE* %log, i8* getelementptr inbounds ([23 x i8]* @.str1, i64 0, i64 0), double %50, double %53, double %56) #6
  %58 = fpext float %36 to double
  %59 = fpext float %38 to double
  %60 = fpext float %40 to double
  %61 = call i32 (%struct.__sFILE*, i8*, ...)* @fprintf(%struct.__sFILE* %log, i8* getelementptr inbounds ([23 x i8]* @.str2, i64 0, i64 0), double %58, double %59, double %60) #6
  %62 = fpext float %42 to double
  %63 = fpext float %44 to double
  %64 = fpext float %46 to double
  %65 = call i32 (%struct.__sFILE*, i8*, ...)* @fprintf(%struct.__sFILE* %log, i8* getelementptr inbounds ([23 x i8]* @.str3, i64 0, i64 0), double %62, double %63, double %64) #6
  %66 = load float* %5, align 4, !tbaa !15
  %67 = fpext float %66 to double
  %68 = load float* %13, align 4, !tbaa !15
  %69 = fpext float %68 to double
  %70 = load float* %18, align 4, !tbaa !15
  %71 = fpext float %70 to double
  %72 = call i32 (%struct.__sFILE*, i8*, ...)* @fprintf(%struct.__sFILE* %log, i8* getelementptr inbounds ([23 x i8]* @.str4, i64 0, i64 0), double %67, double %69, double %71) #6
  %73 = load i32* %nx, align 4, !tbaa !14
  %74 = load i32* %ny, align 4, !tbaa !14
  %75 = load i32* %nz, align 4, !tbaa !14
  call void @calc_nxyz(i32 %73, i32 %74, i32 %75, i32** @ps_gather_f.nnx, i32** @ps_gather_f.nny, i32** @ps_gather_f.nnz) #6
  br label %76

; <label>:76                                      ; preds = %76, %47
  %indvars.iv17 = phi i64 [ 0, %47 ], [ %indvars.iv.next18, %76 ]
  %77 = trunc i64 %indvars.iv17 to i32
  %78 = sdiv i32 %77, 9
  %79 = add nsw i32 %78, 2
  %80 = mul nsw i64 %indvars.iv17, 3
  %81 = getelementptr inbounds [81 x i32]* @ps_gather_f.JCXYZ, i64 0, i64 %80
  store i32 %79, i32* %81, align 4, !tbaa !14
  %82 = sdiv i32 %77, 3
  %83 = srem i32 %82, 3
  %84 = add nsw i32 %83, 2
  %85 = add nuw nsw i64 %80, 1
  %86 = getelementptr inbounds [81 x i32]* @ps_gather_f.JCXYZ, i64 0, i64 %85
  store i32 %84, i32* %86, align 4, !tbaa !14
  %87 = srem i32 %77, 3
  %88 = add nsw i32 %87, 2
  %89 = add nuw nsw i64 %80, 2
  %90 = getelementptr inbounds [81 x i32]* @ps_gather_f.JCXYZ, i64 0, i64 %89
  store i32 %88, i32* %90, align 4, !tbaa !14
  %indvars.iv.next18 = add nuw nsw i64 %indvars.iv17, 1
  %exitcond19 = icmp eq i64 %indvars.iv.next18, 27
  br i1 %exitcond19, label %91, label %76

; <label>:91                                      ; preds = %76
  store i1 true, i1* @ps_gather_f.bFirst, align 1
  br label %.preheader

.preheader:                                       ; preds = %34, %91
  %92 = icmp sgt i32 %natoms, 0
  br i1 %92, label %.lr.ph, label %133

.lr.ph:                                           ; preds = %.preheader
  %93 = getelementptr inbounds [3 x i32]* %ixyz, i64 0, i64 0
  %94 = getelementptr inbounds [27 x float]* %WXYZ, i64 0, i64 0
  %95 = getelementptr inbounds [3 x i32]* %ixyz, i64 0, i64 1
  %96 = getelementptr inbounds [3 x i32]* %ixyz, i64 0, i64 2
  %97 = getelementptr inbounds [7 x i32]* %ixw, i64 0, i64 0
  %98 = getelementptr inbounds [7 x i32]* %iyw, i64 0, i64 0
  %99 = getelementptr inbounds [7 x i32]* %izw, i64 0, i64 0
  %100 = add i32 %natoms, -1
  br label %101

; <label>:101                                     ; preds = %101, %.lr.ph
  %indvars.iv = phi i64 [ 0, %.lr.ph ], [ %indvars.iv.next, %101 ]
  %energy.02 = phi float [ 0.000000e+00, %.lr.ph ], [ %131, %101 ]
  %102 = load i32* %nx, align 4, !tbaa !14
  %103 = load i32* %ny, align 4, !tbaa !14
  %104 = load i32* %nz, align 4, !tbaa !14
  %105 = getelementptr inbounds [3 x float]* %x, i64 %indvars.iv, i64 0
  %106 = trunc i64 %indvars.iv to i32
  call void @calc_weights(i32 %106, i32 %102, i32 %103, i32 %104, float* %105, float* %box, float* %5, i32* %93, float* %94) #6
  %107 = load i32* %93, align 4, !tbaa !14
  %108 = load i32* %nx, align 4, !tbaa !14
  %109 = load i32** @ps_gather_f.nnx, align 8, !tbaa !17
  %110 = load i32* %95, align 4, !tbaa !14
  %111 = load i32* %ny, align 4, !tbaa !14
  %112 = load i32** @ps_gather_f.nny, align 8, !tbaa !17
  %113 = load i32* %96, align 4, !tbaa !14
  %114 = load i32* %nz, align 4, !tbaa !14
  %115 = load i32** @ps_gather_f.nnz, align 8, !tbaa !17
  %116 = sext i32 %107 to i64
  %117 = sext i32 %108 to i64
  %118 = add nsw i64 %116, %117
  %scevgep.sum = add nsw i64 %118, -3
  %scevgep7 = getelementptr i32* %109, i64 %scevgep.sum
  %scevgep78 = bitcast i32* %scevgep7 to i8*
  call void @llvm.memcpy.p0i8.p0i8.i64(i8* %ixw6, i8* %scevgep78, i64 28, i32 4, i1 false)
  %119 = sext i32 %110 to i64
  %120 = sext i32 %111 to i64
  %121 = add nsw i64 %119, %120
  %scevgep10.sum = add nsw i64 %121, -3
  %scevgep11 = getelementptr i32* %112, i64 %scevgep10.sum
  %scevgep1112 = bitcast i32* %scevgep11 to i8*
  call void @llvm.memcpy.p0i8.p0i8.i64(i8* %iyw9, i8* %scevgep1112, i64 28, i32 4, i1 false)
  %122 = sext i32 %113 to i64
  %123 = sext i32 %114 to i64
  %124 = add nsw i64 %122, %123
  %scevgep14.sum = add nsw i64 %124, -3
  %scevgep15 = getelementptr i32* %115, i64 %scevgep14.sum
  %scevgep1516 = bitcast i32* %scevgep15 to i8*
  call void @llvm.memcpy.p0i8.p0i8.i64(i8* %izw13, i8* %scevgep1516, i64 28, i32 4, i1 false)
  %125 = getelementptr inbounds float* %charge, i64 %indvars.iv
  %126 = load float* %125, align 4, !tbaa !15
  %127 = getelementptr inbounds [3 x float]* %f, i64 %indvars.iv, i64 0
  %128 = load float**** %ptr, align 8, !tbaa !17
  %129 = call float @ps_gather_inner(i32* getelementptr inbounds ([81 x i32]* @ps_gather_f.JCXYZ, i64 0, i64 0), float* %94, i32* %97, i32* %98, i32* %99, float %36, float %38, float %40, float %42, float %44, float %46, float %126, float* %127, float*** %128) #7
  %130 = fmul float %126, %129
  %131 = fadd float %energy.02, %130
  %132 = getelementptr inbounds float* %pot, i64 %indvars.iv
  store float %129, float* %132, align 4, !tbaa !15
  %indvars.iv.next = add nuw nsw i64 %indvars.iv, 1
  %exitcond = icmp eq i32 %106, %100
  br i1 %exitcond, label %._crit_edge, label %101

._crit_edge:                                      ; preds = %101
  %phitmp = fmul float %131, 5.000000e-01
  br label %133

; <label>:133                                     ; preds = %._crit_edge, %.preheader
  %energy.0.lcssa = phi float [ %phitmp, %._crit_edge ], [ 0.000000e+00, %.preheader ]
  %134 = mul nsw i32 %natoms, 27
  %135 = sitofp i32 %134 to double
  %136 = getelementptr inbounds %struct.t_nrnb* %nrnb, i64 0, i32 0, i64 82
  %137 = load double* %136, align 8, !tbaa !18
  %138 = fadd double %135, %137
  store double %138, double* %136, align 8, !tbaa !18
  %139 = mul nsw i32 %natoms, 3
  %140 = sitofp i32 %139 to double
  %141 = getelementptr inbounds %struct.t_nrnb* %nrnb, i64 0, i32 0, i64 79
  %142 = load double* %141, align 8, !tbaa !18
  %143 = fadd double %140, %142
  store double %143, double* %141, align 8, !tbaa !18
  call void @llvm.lifetime.end(i64 108, i8* %1) #4
  ret float %energy.0.lcssa
}
