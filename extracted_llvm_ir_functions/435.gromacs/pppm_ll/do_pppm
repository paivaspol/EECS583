define float @do_pppm(%struct._IO_FILE* nocapture %log, i32 %bVerbose, [3 x float]* nocapture %x, [3 x float]* nocapture %f, float* nocapture %charge, float* nocapture %box, float* nocapture %phi, %struct.t_commrec* %cr, %struct.t_nsborder* %nsb, %struct.t_nrnb* nocapture %nrnb) #0 {
entry:
  %nodeid = getelementptr inbounds %struct.t_nsborder* %nsb, i64 0, i32 0
  %0 = load i32* %nodeid, align 4, !tbaa !3
  %idxprom = sext i32 %0 to i64
  %arrayidx = getelementptr inbounds %struct.t_nsborder* %nsb, i64 0, i32 8, i64 %idxprom
  %1 = load i32* %arrayidx, align 4, !tbaa !3
  %arrayidx3 = getelementptr inbounds %struct.t_nsborder* %nsb, i64 0, i32 7, i64 %idxprom
  %2 = load i32* %arrayidx3, align 4, !tbaa !3
  %3 = load %struct.t_fftgrid** @grid, align 8, !tbaa !4
  tail call void @clear_fftgrid(%struct.t_fftgrid* %3) #4
  %4 = load %struct.t_fftgrid** @grid, align 8, !tbaa !4
  tail call void @spread_q(%struct._IO_FILE* %log, i32 undef, i32 %1, i32 %2, [3 x float]* %x, float* %charge, float* %box, %struct.t_fftgrid* %4, %struct.t_nrnb* %nrnb) #5
  %nnodes = getelementptr inbounds %struct.t_commrec* %cr, i64 0, i32 1
  %5 = load i32* %nnodes, align 4, !tbaa !3
  %cmp = icmp sgt i32 %5, 1
  br i1 %cmp, label %if.then, label %lor.lhs.false

lor.lhs.false:                                    ; preds = %entry
  %nthreads = getelementptr inbounds %struct.t_commrec* %cr, i64 0, i32 5
  %6 = load i32* %nthreads, align 4, !tbaa !3
  %cmp4 = icmp sgt i32 %6, 1
  br i1 %cmp4, label %if.then, label %if.end

if.then:                                          ; preds = %lor.lhs.false, %entry
  %7 = load %struct.t_fftgrid** @grid, align 8, !tbaa !4
  tail call void @sum_qgrid(%struct.t_commrec* %cr, %struct.t_nsborder* %nsb, %struct.t_fftgrid* %7, i32 1) #4
  br label %if.end

if.end:                                           ; preds = %if.then, %lor.lhs.false
  %8 = load %struct.t_fftgrid** @grid, align 8, !tbaa !4
  %9 = load float**** @ghat, align 8, !tbaa !4
  tail call void @solve_pppm(%struct._IO_FILE* undef, %struct.t_commrec* %cr, %struct.t_fftgrid* %8, float*** %9, float* undef, i32 %bVerbose, %struct.t_nrnb* %nrnb) #5
  %10 = load i32* %nnodes, align 4, !tbaa !3
  %cmp6 = icmp sgt i32 %10, 1
  br i1 %cmp6, label %if.then10, label %lor.lhs.false7

lor.lhs.false7:                                   ; preds = %if.end
  %nthreads8 = getelementptr inbounds %struct.t_commrec* %cr, i64 0, i32 5
  %11 = load i32* %nthreads8, align 4, !tbaa !3
  %cmp9 = icmp sgt i32 %11, 1
  br i1 %cmp9, label %if.then10, label %if.end11

if.then10:                                        ; preds = %lor.lhs.false7, %if.end
  %12 = load %struct.t_fftgrid** @grid, align 8, !tbaa !4
  tail call void @sum_qgrid(%struct.t_commrec* %cr, %struct.t_nsborder* %nsb, %struct.t_fftgrid* %12, i32 0) #4
  br label %if.end11

if.end11:                                         ; preds = %if.then10, %lor.lhs.false7
  %13 = load %struct.t_fftgrid** @grid, align 8, !tbaa !4
  %call = tail call fastcc float @gather_f(%struct._IO_FILE* %log, i32 %1, i32 %2, [3 x float]* %x, [3 x float]* %f, float* %charge, float* %box, float* %phi, %struct.t_fftgrid* %13, float* getelementptr inbounds ([3 x float]* @beta, i64 0, i64 0), %struct.t_nrnb* %nrnb) #5
  ret float %call
}
