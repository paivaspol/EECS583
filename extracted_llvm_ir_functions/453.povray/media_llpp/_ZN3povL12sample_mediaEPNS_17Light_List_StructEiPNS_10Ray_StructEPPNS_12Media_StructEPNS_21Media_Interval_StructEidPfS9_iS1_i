define internal fastcc void @_ZN3povL12sample_mediaEPNS_17Light_List_StructEiPNS_10Ray_StructEPPNS_12Media_StructEPNS_21Media_Interval_StructEidPfS9_iS1_i(%"struct.pov::Light_List_Struct"* nocapture readonly %light_list, i32 %global_light_list_cnt, %"struct.pov::Ray_Struct"* %Ray, %"struct.pov::Media_Struct"** nocapture readonly %Media_List, %"struct.pov::Media_Interval_Struct"* nocapture %Interval, i32 %light_ray, double %d0, float* nocapture %SampCol, float* nocapture %SampOptDepth, i32 %sample_method, %"struct.pov::Light_List_Struct"* nocapture readonly %local_light_list, i32 %local_light_list_cnt) #0 {
  %Local_Color.i = alloca [5 x float], align 16
  %len = alloca double, align 8
  %P = alloca [3 x double], align 16
  %H = alloca [3 x double], align 16
  %Light_Colour = alloca [5 x float], align 16
  %Te = alloca [5 x float], align 16
  %Sc = alloca [5 x float], align 16
  %Light_Ray = alloca %"struct.pov::Ray_Struct", align 16
  %tempr = alloca double, align 8
  %TempCol = alloca [5 x float], align 16
  tail call void @llvm.dbg.value(metadata %"struct.pov::Light_List_Struct"* %light_list, i64 0, metadata !1199, metadata !1851), !dbg !2395
  tail call void @llvm.dbg.value(metadata i32 %global_light_list_cnt, i64 0, metadata !1200, metadata !1851), !dbg !2396
  tail call void @llvm.dbg.value(metadata %"struct.pov::Ray_Struct"* %Ray, i64 0, metadata !1201, metadata !1851), !dbg !2397
  tail call void @llvm.dbg.value(metadata %"struct.pov::Media_Struct"** %Media_List, i64 0, metadata !1202, metadata !1851), !dbg !2398
  tail call void @llvm.dbg.value(metadata %"struct.pov::Media_Interval_Struct"* %Interval, i64 0, metadata !1203, metadata !1851), !dbg !2399
  tail call void @llvm.dbg.value(metadata i32 %light_ray, i64 0, metadata !1204, metadata !1851), !dbg !2400
  tail call void @llvm.dbg.value(metadata double %d0, i64 0, metadata !1205, metadata !1851), !dbg !2401
  tail call void @llvm.dbg.value(metadata float* %SampCol, i64 0, metadata !1206, metadata !1851), !dbg !2402
  tail call void @llvm.dbg.value(metadata float* %SampOptDepth, i64 0, metadata !1207, metadata !1851), !dbg !2403
  tail call void @llvm.dbg.value(metadata i32 %sample_method, i64 0, metadata !1208, metadata !1851), !dbg !2404
  tail call void @llvm.dbg.value(metadata %"struct.pov::Light_List_Struct"* %local_light_list, i64 0, metadata !1209, metadata !1851), !dbg !2405
  tail call void @llvm.dbg.value(metadata i32 %local_light_list_cnt, i64 0, metadata !1210, metadata !1851), !dbg !2406
  tail call void @llvm.dbg.declare(metadata [3 x double]* %P, metadata !1216, metadata !1851), !dbg !2407
  tail call void @llvm.dbg.declare(metadata [3 x double]* %H, metadata !1217, metadata !1851), !dbg !2408
  tail call void @llvm.dbg.declare(metadata [5 x float]* undef, metadata !1218, metadata !1851), !dbg !2409
  tail call void @llvm.dbg.declare(metadata [5 x float]* %Light_Colour, metadata !1219, metadata !1851), !dbg !2410
  tail call void @llvm.dbg.declare(metadata [5 x float]* %Te, metadata !1220, metadata !1851), !dbg !2411
  tail call void @llvm.dbg.declare(metadata [5 x float]* undef, metadata !1221, metadata !1851), !dbg !2412
  tail call void @llvm.dbg.declare(metadata [5 x float]* undef, metadata !1222, metadata !1851), !dbg !2413
  tail call void @llvm.dbg.declare(metadata [5 x float]* %Sc, metadata !1223, metadata !1851), !dbg !2414
  %1 = bitcast %"struct.pov::Ray_Struct"* %Light_Ray to i8*, !dbg !2415
  call void @llvm.lifetime.start(i64 856, i8* %1) #4, !dbg !2415
  tail call void @llvm.dbg.value(metadata i64* getelementptr inbounds ([126 x i64]* @_ZN3pov5statsE, i64 0, i64 99), i64 0, metadata !1133, metadata !1851), !dbg !2416
  %2 = load i64* getelementptr inbounds ([126 x i64]* @_ZN3pov5statsE, i64 0, i64 99), align 8, !dbg !2418, !tbaa !1862
  %3 = add nsw i64 %2, 1, !dbg !2418
  store i64 %3, i64* getelementptr inbounds ([126 x i64]* @_ZN3pov5statsE, i64 0, i64 99), align 8, !dbg !2418, !tbaa !1862
  %4 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Interval, i64 0, i32 4, !dbg !2419
  %5 = load double* %4, align 8, !dbg !2419, !tbaa !2035
  %6 = fmul double %5, %d0, !dbg !2420
  tail call void @llvm.dbg.value(metadata double %6, i64 0, metadata !1205, metadata !1851), !dbg !2401
  %7 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Interval, i64 0, i32 2, !dbg !2421
  %8 = load double* %7, align 8, !dbg !2421, !tbaa !2108
  %9 = fadd double %8, %6, !dbg !2422
  tail call void @llvm.dbg.value(metadata double %9, i64 0, metadata !1214, metadata !1851), !dbg !2423
  %10 = getelementptr inbounds [3 x double]* %H, i64 0, i64 0, !dbg !2424
  %11 = getelementptr inbounds %"struct.pov::Ray_Struct"* %Ray, i64 0, i32 1, i64 0, !dbg !2425
  tail call void @llvm.dbg.value(metadata double* %10, i64 0, metadata !1149, metadata !1851), !dbg !2426
  tail call void @llvm.dbg.value(metadata double %9, i64 0, metadata !1151, metadata !1851), !dbg !2428
  tail call void @llvm.dbg.value(metadata double* %11, i64 0, metadata !1152, metadata !1851), !dbg !2429
  %12 = bitcast %"struct.pov::Ray_Struct"* %Ray to <2 x double>*, !dbg !2430
  %13 = load <2 x double>* %12, align 8, !dbg !2430, !tbaa !2166
  %14 = bitcast double* %11 to <2 x double>*, !dbg !2431
  %15 = load <2 x double>* %14, align 8, !dbg !2431, !tbaa !2166
  %16 = insertelement <2 x double> undef, double %9, i32 0, !dbg !2432
  %17 = insertelement <2 x double> %16, double %9, i32 1, !dbg !2432
  %18 = fmul <2 x double> %17, %15, !dbg !2432
  %19 = fadd <2 x double> %13, %18, !dbg !2433
  %20 = bitcast [3 x double]* %H to <2 x double>*, !dbg !2434
  store <2 x double> %19, <2 x double>* %20, align 16, !dbg !2434, !tbaa !2166
  %21 = getelementptr inbounds %"struct.pov::Ray_Struct"* %Ray, i64 0, i32 0, i64 2, !dbg !2435
  %22 = load double* %21, align 8, !dbg !2435, !tbaa !2166
  %23 = getelementptr inbounds %"struct.pov::Ray_Struct"* %Ray, i64 0, i32 1, i64 2, !dbg !2436
  %24 = load double* %23, align 8, !dbg !2436, !tbaa !2166
  %25 = fmul double %9, %24, !dbg !2437
  %26 = fadd double %22, %25, !dbg !2438
  %27 = getelementptr inbounds [3 x double]* %H, i64 0, i64 2, !dbg !2439
  store double %26, double* %27, align 16, !dbg !2440, !tbaa !2166
  tail call void @llvm.dbg.value(metadata float* undef, i64 0, metadata !1157, metadata !1851), !dbg !2441
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1158, metadata !1851), !dbg !2443
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1159, metadata !1851), !dbg !2444
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1160, metadata !1851), !dbg !2445
  tail call void @llvm.dbg.value(metadata i32 0, i64 0, metadata !1221, metadata !1981), !dbg !2412
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1221, metadata !2446), !dbg !2412
  tail call void @llvm.dbg.value(metadata float* undef, i64 0, metadata !1157, metadata !1851), !dbg !2447
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1158, metadata !1851), !dbg !2449
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1159, metadata !1851), !dbg !2450
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1160, metadata !1851), !dbg !2451
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1222, metadata !1981), !dbg !2413
  %28 = getelementptr inbounds [5 x float]* %Sc, i64 0, i64 0, !dbg !2452
  tail call void @llvm.dbg.value(metadata float* %28, i64 0, metadata !1157, metadata !1851), !dbg !2453
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1158, metadata !1851), !dbg !2455
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1159, metadata !1851), !dbg !2456
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1160, metadata !1851), !dbg !2457
  %29 = getelementptr inbounds [5 x float]* %Sc, i64 0, i64 1, !dbg !2458
  %30 = getelementptr inbounds [5 x float]* %Sc, i64 0, i64 2, !dbg !2459
  tail call void @llvm.dbg.value(metadata i32 0, i64 0, metadata !1213, metadata !1851), !dbg !2460
  tail call void @llvm.dbg.value(metadata %"struct.pov::Media_Struct"** %Media_List, i64 0, metadata !1225, metadata !1851), !dbg !2461
  tail call void @llvm.dbg.declare(metadata [5 x float]* %Local_Color.i, metadata !1264, metadata !1851), !dbg !2462
  %31 = bitcast [5 x float]* %Sc to i8*, !dbg !2470
  call void @llvm.memset.p0i8.i64(i8* %31, i8 0, i64 20, i32 16, i1 false), !dbg !2471
  %32 = load %"struct.pov::Media_Struct"** %Media_List, align 8, !dbg !2470, !tbaa !1870
  %33 = icmp eq %"struct.pov::Media_Struct"* %32, null, !dbg !2472
  br i1 %33, label %150, label %.preheader16.lr.ph, !dbg !2473

.preheader16.lr.ph:                               ; preds = %0
  %34 = getelementptr inbounds [3 x double]* %P, i64 0, i64 0, !dbg !2474
  %35 = bitcast double* %27 to i64*, !dbg !2475
  %36 = getelementptr inbounds [3 x double]* %P, i64 0, i64 2, !dbg !2477
  %37 = bitcast double* %36 to i64*, !dbg !2478
  %38 = bitcast [5 x float]* %Local_Color.i to i8*, !dbg !2479
  %39 = icmp eq i32 %light_ray, 0, !dbg !2480
  %40 = getelementptr inbounds [5 x float]* %Local_Color.i, i64 0, i64 0, !dbg !2482
  %41 = getelementptr inbounds [5 x float]* %Local_Color.i, i64 0, i64 1, !dbg !2484
  %42 = getelementptr inbounds [5 x float]* %Local_Color.i, i64 0, i64 2, !dbg !2486
  br label %.preheader16, !dbg !2473

.preheader16:                                     ; preds = %.preheader16.lr.ph, %._crit_edge63
  %43 = phi float [ 0.000000e+00, %.preheader16.lr.ph ], [ %143, %._crit_edge63 ]
  %44 = phi float [ 0.000000e+00, %.preheader16.lr.ph ], [ %144, %._crit_edge63 ]
  %45 = phi float [ 0.000000e+00, %.preheader16.lr.ph ], [ %145, %._crit_edge63 ]
  %46 = phi %"struct.pov::Media_Struct"* [ %32, %.preheader16.lr.ph ], [ %148, %._crit_edge63 ]
  %use_scattering.072 = phi i32 [ 0, %.preheader16.lr.ph ], [ %use_scattering.1.lcssa, %._crit_edge63 ]
  %Tmp.071 = phi %"struct.pov::Media_Struct"** [ %Media_List, %.preheader16.lr.ph ], [ %147, %._crit_edge63 ]
  %47 = phi float [ 0.000000e+00, %.preheader16.lr.ph ], [ %.lcssa25, %._crit_edge63 ]
  %48 = phi i32 [ 0, %.preheader16.lr.ph ], [ %.lcssa24, %._crit_edge63 ]
  %49 = phi i32 [ 0, %.preheader16.lr.ph ], [ %.lcssa23, %._crit_edge63 ]
  %50 = phi i32 [ 0, %.preheader16.lr.ph ], [ %.lcssa22, %._crit_edge63 ]
  %51 = phi <2 x float> [ zeroinitializer, %.preheader16.lr.ph ], [ %146, %._crit_edge63 ]
  %52 = icmp eq %"struct.pov::Media_Struct"* %46, null, !dbg !2487
  br i1 %52, label %._crit_edge63, label %.lr.ph62, !dbg !2488

.lr.ph62:                                         ; preds = %.preheader16, %130
  %53 = phi float [ %131, %130 ], [ %43, %.preheader16 ]
  %54 = phi float [ %132, %130 ], [ %44, %.preheader16 ]
  %55 = phi float [ %133, %130 ], [ %45, %.preheader16 ]
  %use_scattering.161 = phi i32 [ %139, %130 ], [ %use_scattering.072, %.preheader16 ]
  %Local.060 = phi %"struct.pov::Media_Struct"* [ %141, %130 ], [ %46, %.preheader16 ]
  %56 = phi float [ %98, %130 ], [ %47, %.preheader16 ]
  %57 = phi i32 [ %136, %130 ], [ %48, %.preheader16 ]
  %58 = phi i32 [ %135, %130 ], [ %49, %.preheader16 ]
  %59 = phi i32 [ %134, %130 ], [ %50, %.preheader16 ]
  %60 = phi <2 x float> [ %94, %130 ], [ %51, %.preheader16 ]
  tail call void @llvm.dbg.value(metadata double* %34, i64 0, metadata !1255, metadata !1851), !dbg !2489
  tail call void @llvm.dbg.value(metadata double* %10, i64 0, metadata !1256, metadata !1851), !dbg !2490
  %61 = bitcast [3 x double]* %H to <2 x i64>*, !dbg !2491
  %62 = load <2 x i64>* %61, align 16, !dbg !2491, !tbaa !2166
  %63 = bitcast [3 x double]* %P to <2 x i64>*, !dbg !2492
  store <2 x i64> %62, <2 x i64>* %63, align 16, !dbg !2492, !tbaa !2166
  %64 = load i64* %35, align 16, !dbg !2475, !tbaa !2166
  store i64 %64, i64* %37, align 16, !dbg !2478, !tbaa !2166
  call void @llvm.lifetime.start(i64 20, i8* %38), !dbg !2479
  call void @llvm.dbg.value(metadata %"struct.pov::Media_Struct"* %141, i64 0, metadata !1261, metadata !1851), !dbg !2479
  call void @llvm.dbg.value(metadata double* %34, i64 0, metadata !1262, metadata !1851), !dbg !2493
  call void @llvm.dbg.value(metadata float* undef, i64 0, metadata !1263, metadata !1851), !dbg !2494
  %65 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.060, i64 0, i32 24, !dbg !2495
  %66 = load %"struct.pov::Pigment_Struct"** %65, align 8, !dbg !2495, !tbaa !2496
  call void @llvm.dbg.value(metadata %"struct.pov::Pigment_Struct"* %66, i64 0, metadata !1265, metadata !1851), !dbg !2497
  call void @llvm.dbg.value(metadata float* undef, i64 0, metadata !1157, metadata !1851), !dbg !2498
  call void @llvm.dbg.value(metadata float 1.000000e+00, i64 0, metadata !1158, metadata !1851), !dbg !2500
  call void @llvm.dbg.value(metadata float 1.000000e+00, i64 0, metadata !1159, metadata !1851), !dbg !2501
  call void @llvm.dbg.value(metadata float 1.000000e+00, i64 0, metadata !1160, metadata !1851), !dbg !2502
  call void @llvm.dbg.value(metadata float 1.000000e+00, i64 0, metadata !1218, metadata !1981), !dbg !2409
  call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1218, metadata !2446), !dbg !2409
  %67 = icmp eq %"struct.pov::Pigment_Struct"* %66, null, !dbg !2503
  br i1 %67, label %_ZN3povL24evaluate_density_patternEPNS_12Media_StructEPdPf.exit, label %.lr.ph.i, !dbg !2504

.lr.ph.i:                                         ; preds = %.lr.ph62, %.lr.ph.i
  %68 = phi float [ %77, %.lr.ph.i ], [ 1.000000e+00, %.lr.ph62 ], !dbg !2505
  %69 = phi float [ %75, %.lr.ph.i ], [ 1.000000e+00, %.lr.ph62 ], !dbg !2505
  %70 = phi float [ %73, %.lr.ph.i ], [ 1.000000e+00, %.lr.ph62 ], !dbg !2505
  %Temp.01.i = phi %"struct.pov::Pigment_Struct"* [ %80, %.lr.ph.i ], [ %66, %.lr.ph62 ], !dbg !2506
  call void @llvm.dbg.value(metadata float* %40, i64 0, metadata !1157, metadata !1851), !dbg !2505
  call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1158, metadata !1851), !dbg !2507
  call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1159, metadata !1851), !dbg !2508
  call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1160, metadata !1851), !dbg !2509
  call void @llvm.memset.p0i8.i64(i8* %38, i8 0, i64 20, i32 16, i1 false), !dbg !2510
  %71 = call i32 @_ZN3pov15Compute_PigmentEPfPNS_14Pigment_StructEPdPNS_10istk_entryE(float* %40, %"struct.pov::Pigment_Struct"* %Temp.01.i, double* %34, %"struct.pov::istk_entry"* null) #7, !dbg !2511
  %72 = load float* %40, align 16, !dbg !2512, !tbaa !1991
  %73 = fmul float %70, %72, !dbg !2513
  call void @llvm.dbg.value(metadata float %73, i64 0, metadata !1218, metadata !1981), !dbg !2409
  %74 = load float* %41, align 4, !dbg !2514, !tbaa !1991
  %75 = fmul float %69, %74, !dbg !2515
  call void @llvm.dbg.value(metadata float %75, i64 0, metadata !1218, metadata !1983), !dbg !2409
  %76 = load float* %42, align 8, !dbg !2516, !tbaa !1991
  %77 = fmul float %68, %76, !dbg !2517
  call void @llvm.dbg.value(metadata float %77, i64 0, metadata !1218, metadata !1985), !dbg !2409
  %78 = getelementptr inbounds %"struct.pov::Pigment_Struct"* %Temp.01.i, i64 0, i32 8, !dbg !2518
  %79 = bitcast %"struct.pov::Pattern_Struct"** %78 to %"struct.pov::Pigment_Struct"**, !dbg !2518
  %80 = load %"struct.pov::Pigment_Struct"** %79, align 8, !dbg !2518, !tbaa !2519
  call void @llvm.dbg.value(metadata %"struct.pov::Pigment_Struct"* %80, i64 0, metadata !1265, metadata !1851), !dbg !2497
  %81 = icmp eq %"struct.pov::Pigment_Struct"* %80, null, !dbg !2503
  br i1 %81, label %_ZN3povL24evaluate_density_patternEPNS_12Media_StructEPdPf.exit, label %.lr.ph.i, !dbg !2504

_ZN3povL24evaluate_density_patternEPNS_12Media_StructEPdPf.exit: ; preds = %.lr.ph.i, %.lr.ph62
  %82 = phi float [ 1.000000e+00, %.lr.ph62 ], [ %77, %.lr.ph.i ]
  %83 = phi float [ 1.000000e+00, %.lr.ph62 ], [ %75, %.lr.ph.i ]
  %84 = phi float [ 1.000000e+00, %.lr.ph62 ], [ %73, %.lr.ph.i ]
  call void @llvm.lifetime.end(i64 20, i8* %38), !dbg !2522
  %85 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.060, i64 0, i32 15, i64 0, !dbg !2523
  %86 = load float* %85, align 4, !dbg !2523, !tbaa !1991
  call void @llvm.dbg.value(metadata float undef, i64 0, metadata !1222, metadata !1981), !dbg !2413
  %87 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.060, i64 0, i32 15, i64 1, !dbg !2524
  %88 = load float* %87, align 4, !dbg !2524, !tbaa !1991
  %89 = insertelement <2 x float> undef, float %83, i32 0, !dbg !2525
  %90 = insertelement <2 x float> %89, float %84, i32 1, !dbg !2525
  %91 = insertelement <2 x float> undef, float %88, i32 0, !dbg !2525
  %92 = insertelement <2 x float> %91, float %86, i32 1, !dbg !2525
  %93 = fmul <2 x float> %90, %92, !dbg !2525
  %94 = fadd <2 x float> %60, %93, !dbg !2526
  call void @llvm.dbg.value(metadata float undef, i64 0, metadata !1222, metadata !1983), !dbg !2413
  %95 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.060, i64 0, i32 15, i64 2, !dbg !2527
  %96 = load float* %95, align 4, !dbg !2527, !tbaa !1991
  %97 = fmul float %82, %96, !dbg !2528
  %98 = fadd float %56, %97, !dbg !2529
  call void @llvm.dbg.value(metadata float %98, i64 0, metadata !1222, metadata !1985), !dbg !2413
  br i1 %39, label %99, label %130, !dbg !2530

; <label>:99                                      ; preds = %_ZN3povL24evaluate_density_patternEPNS_12Media_StructEPdPf.exit
  %100 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.060, i64 0, i32 14, i64 0, !dbg !2531
  %101 = load float* %100, align 4, !dbg !2531, !tbaa !1991
  %102 = fmul float %84, %101, !dbg !2533
  %103 = bitcast i32 %57 to float, !dbg !2534
  %104 = fadd float %103, %102, !dbg !2534
  %105 = bitcast float %104 to i32, !dbg !2534
  call void @llvm.dbg.value(metadata i32 %105, i64 0, metadata !1221, metadata !1981), !dbg !2412
  %106 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.060, i64 0, i32 14, i64 1, !dbg !2535
  %107 = load float* %106, align 4, !dbg !2535, !tbaa !1991
  %108 = fmul float %83, %107, !dbg !2536
  %109 = bitcast i32 %58 to float, !dbg !2537
  %110 = fadd float %109, %108, !dbg !2537
  %111 = bitcast float %110 to i32, !dbg !2537
  call void @llvm.dbg.value(metadata i32 %111, i64 0, metadata !1221, metadata !1983), !dbg !2412
  %112 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.060, i64 0, i32 14, i64 2, !dbg !2538
  %113 = load float* %112, align 4, !dbg !2538, !tbaa !1991
  %114 = fmul float %82, %113, !dbg !2539
  %115 = bitcast i32 %59 to float, !dbg !2540
  %116 = fadd float %115, %114, !dbg !2540
  %117 = bitcast float %116 to i32, !dbg !2540
  call void @llvm.dbg.value(metadata i32 %117, i64 0, metadata !1221, metadata !1985), !dbg !2412
  %118 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.060, i64 0, i32 16, i64 0, !dbg !2541
  %119 = load float* %118, align 4, !dbg !2541, !tbaa !1991
  %120 = fmul float %84, %119, !dbg !2542
  %121 = fadd float %55, %120, !dbg !2543
  store float %121, float* %28, align 16, !dbg !2543, !tbaa !1991
  %122 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.060, i64 0, i32 16, i64 1, !dbg !2544
  %123 = load float* %122, align 4, !dbg !2544, !tbaa !1991
  %124 = fmul float %83, %123, !dbg !2545
  %125 = fadd float %54, %124, !dbg !2546
  store float %125, float* %29, align 4, !dbg !2546, !tbaa !1991
  %126 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.060, i64 0, i32 16, i64 2, !dbg !2547
  %127 = load float* %126, align 4, !dbg !2547, !tbaa !1991
  %128 = fmul float %82, %127, !dbg !2548
  %129 = fadd float %53, %128, !dbg !2549
  store float %129, float* %30, align 8, !dbg !2549, !tbaa !1991
  br label %130, !dbg !2550

; <label>:130                                     ; preds = %_ZN3povL24evaluate_density_patternEPNS_12Media_StructEPdPf.exit, %99
  %131 = phi float [ %53, %_ZN3povL24evaluate_density_patternEPNS_12Media_StructEPdPf.exit ], [ %129, %99 ]
  %132 = phi float [ %54, %_ZN3povL24evaluate_density_patternEPNS_12Media_StructEPdPf.exit ], [ %125, %99 ]
  %133 = phi float [ %55, %_ZN3povL24evaluate_density_patternEPNS_12Media_StructEPdPf.exit ], [ %121, %99 ]
  %134 = phi i32 [ %59, %_ZN3povL24evaluate_density_patternEPNS_12Media_StructEPdPf.exit ], [ %117, %99 ]
  %135 = phi i32 [ %58, %_ZN3povL24evaluate_density_patternEPNS_12Media_StructEPdPf.exit ], [ %111, %99 ]
  %136 = phi i32 [ %57, %_ZN3povL24evaluate_density_patternEPNS_12Media_StructEPdPf.exit ], [ %105, %99 ]
  %137 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.060, i64 0, i32 12, !dbg !2551
  %138 = load i32* %137, align 4, !dbg !2551, !tbaa !1900
  %139 = or i32 %138, %use_scattering.161, !dbg !2552
  call void @llvm.dbg.value(metadata i32 %139, i64 0, metadata !1213, metadata !1851), !dbg !2460
  %140 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.060, i64 0, i32 25, !dbg !2553
  %141 = load %"struct.pov::Media_Struct"** %140, align 8, !dbg !2553, !tbaa !1908
  call void @llvm.dbg.value(metadata %"struct.pov::Media_Struct"* %141, i64 0, metadata !1226, metadata !1851), !dbg !2554
  %142 = icmp eq %"struct.pov::Media_Struct"* %141, null, !dbg !2487
  br i1 %142, label %._crit_edge63, label %.lr.ph62, !dbg !2488

._crit_edge63:                                    ; preds = %130, %.preheader16
  %143 = phi float [ %43, %.preheader16 ], [ %131, %130 ]
  %144 = phi float [ %44, %.preheader16 ], [ %132, %130 ]
  %145 = phi float [ %45, %.preheader16 ], [ %133, %130 ]
  %use_scattering.1.lcssa = phi i32 [ %use_scattering.072, %.preheader16 ], [ %139, %130 ]
  %.lcssa25 = phi float [ %47, %.preheader16 ], [ %98, %130 ]
  %.lcssa24 = phi i32 [ %48, %.preheader16 ], [ %136, %130 ]
  %.lcssa23 = phi i32 [ %49, %.preheader16 ], [ %135, %130 ]
  %.lcssa22 = phi i32 [ %50, %.preheader16 ], [ %134, %130 ]
  %146 = phi <2 x float> [ %51, %.preheader16 ], [ %94, %130 ]
  %147 = getelementptr inbounds %"struct.pov::Media_Struct"** %Tmp.071, i64 1, !dbg !2555
  call void @llvm.dbg.value(metadata %"struct.pov::Media_Struct"** %147, i64 0, metadata !1225, metadata !1851), !dbg !2461
  %148 = load %"struct.pov::Media_Struct"** %147, align 8, !dbg !2470, !tbaa !1870
  %149 = icmp eq %"struct.pov::Media_Struct"* %148, null, !dbg !2472
  br i1 %149, label %._crit_edge73, label %.preheader16, !dbg !2473

._crit_edge73:                                    ; preds = %._crit_edge63
  %.pre = load double* %4, align 8, !dbg !2556, !tbaa !2035
  br label %150, !dbg !2473

; <label>:150                                     ; preds = %._crit_edge73, %0
  %151 = phi double [ %.pre, %._crit_edge73 ], [ %5, %0 ]
  %use_scattering.0.lcssa = phi i32 [ %use_scattering.1.lcssa, %._crit_edge73 ], [ 0, %0 ]
  %.lcssa31 = phi float [ %.lcssa25, %._crit_edge73 ], [ 0.000000e+00, %0 ]
  %.lcssa30 = phi i32 [ %.lcssa24, %._crit_edge73 ], [ 0, %0 ]
  %.lcssa29 = phi i32 [ %.lcssa23, %._crit_edge73 ], [ 0, %0 ]
  %.lcssa28 = phi i32 [ %.lcssa22, %._crit_edge73 ], [ 0, %0 ]
  %152 = phi <2 x float> [ %146, %._crit_edge73 ], [ zeroinitializer, %0 ]
  %153 = extractelement <2 x float> %152, i32 1, !dbg !2557
  %154 = fpext float %153 to double, !dbg !2557
  %155 = fmul double %154, %151, !dbg !2558
  %156 = fptrunc double %155 to float, !dbg !2557
  store float %156, float* %SampOptDepth, align 4, !dbg !2559, !tbaa !1991
  %157 = extractelement <2 x float> %152, i32 0, !dbg !2560
  %158 = fpext float %157 to double, !dbg !2560
  %159 = fmul double %158, %151, !dbg !2561
  %160 = fptrunc double %159 to float, !dbg !2560
  %161 = getelementptr inbounds float* %SampOptDepth, i64 1, !dbg !2562
  store float %160, float* %161, align 4, !dbg !2563, !tbaa !1991
  %162 = fpext float %.lcssa31 to double, !dbg !2564
  %163 = fmul double %162, %151, !dbg !2565
  %164 = fptrunc double %163 to float, !dbg !2564
  %165 = getelementptr inbounds float* %SampOptDepth, i64 2, !dbg !2566
  store float %164, float* %165, align 4, !dbg !2567, !tbaa !1991
  %166 = icmp ne i32 %sample_method, 3, !dbg !2568
  br i1 %166, label %167, label %179, !dbg !2570

; <label>:167                                     ; preds = %150
  %168 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Interval, i64 0, i32 5, i64 0, !dbg !2571
  %169 = load float* %168, align 4, !dbg !2573, !tbaa !1991
  %170 = fadd float %156, %169, !dbg !2573
  store float %170, float* %168, align 4, !dbg !2573, !tbaa !1991
  %171 = load float* %161, align 4, !dbg !2574, !tbaa !1991
  %172 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Interval, i64 0, i32 5, i64 1, !dbg !2575
  %173 = load float* %172, align 4, !dbg !2576, !tbaa !1991
  %174 = fadd float %171, %173, !dbg !2576
  store float %174, float* %172, align 4, !dbg !2576, !tbaa !1991
  %175 = load float* %165, align 4, !dbg !2577, !tbaa !1991
  %176 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Interval, i64 0, i32 5, i64 2, !dbg !2578
  %177 = load float* %176, align 4, !dbg !2579, !tbaa !1991
  %178 = fadd float %175, %177, !dbg !2579
  store float %178, float* %176, align 4, !dbg !2579, !tbaa !1991
  br label %179, !dbg !2580

; <label>:179                                     ; preds = %167, %150
  %180 = getelementptr inbounds [5 x float]* %Te, i64 0, i64 0, !dbg !2581
  %181 = bitcast [5 x float]* %Te to i32*, !dbg !2582
  store i32 %.lcssa30, i32* %181, align 16, !dbg !2582, !tbaa !1991
  %182 = getelementptr inbounds [5 x float]* %Te, i64 0, i64 1, !dbg !2583
  %183 = bitcast float* %182 to i32*, !dbg !2584
  store i32 %.lcssa29, i32* %183, align 4, !dbg !2584, !tbaa !1991
  %184 = getelementptr inbounds [5 x float]* %Te, i64 0, i64 2, !dbg !2585
  %185 = bitcast float* %184 to i32*, !dbg !2586
  store i32 %.lcssa28, i32* %185, align 8, !dbg !2586, !tbaa !1991
  %186 = icmp eq i32 %light_ray, 0, !dbg !2587
  %187 = icmp ne i32 %use_scattering.0.lcssa, 0, !dbg !2589
  %or.cond = and i1 %186, %187, !dbg !2590
  br i1 %or.cond, label %188, label %.thread, !dbg !2590

; <label>:188                                     ; preds = %179
  %189 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Interval, i64 0, i32 0, !dbg !2591
  %190 = load i32* %189, align 4, !dbg !2591, !tbaa !2246
  %191 = icmp eq i32 %190, 0, !dbg !2592
  br i1 %191, label %.loopexit, label %192, !dbg !2593

; <label>:192                                     ; preds = %188
  %193 = load i32* @_ZN3pov13backtraceFlagE, align 4, !dbg !2594, !tbaa !2597
  %194 = icmp eq i32 %193, 0, !dbg !2594
  br i1 %194, label %195, label %.preheader14, !dbg !2598

; <label>:195                                     ; preds = %192
  store i32 10485760, i32* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 26), align 4, !dbg !2599, !tbaa !2601
  call void @llvm.dbg.value(metadata i32 1, i64 0, metadata !1227, metadata !1851), !dbg !2602
  call void @llvm.dbg.value(metadata i32 0, i64 0, metadata !1212, metadata !1851), !dbg !2603
  call void @llvm.dbg.value(metadata %"struct.pov::Media_Struct"** %Media_List, i64 0, metadata !1225, metadata !1851), !dbg !2461
  %196 = load %"struct.pov::Media_Struct"** %Media_List, align 8, !dbg !2604, !tbaa !1870
  %197 = icmp eq %"struct.pov::Media_Struct"* %196, null, !dbg !2607
  br i1 %197, label %._crit_edge58.thread, label %.preheader15, !dbg !2608

.preheader15:                                     ; preds = %195, %._crit_edge52
  %198 = phi %"struct.pov::Media_Struct"* [ %208, %._crit_edge52 ], [ %196, %195 ]
  %ignore_photons.057 = phi i32 [ %ignore_photons.1, %._crit_edge52 ], [ 1, %195 ]
  %Tmp.156 = phi %"struct.pov::Media_Struct"** [ %207, %._crit_edge52 ], [ %Media_List, %195 ]
  %199 = icmp eq %"struct.pov::Media_Struct"* %198, null, !dbg !2609
  br i1 %199, label %._crit_edge52, label %.lr.ph51, !dbg !2612

.lr.ph51:                                         ; preds = %.preheader15, %203
  %Local.150 = phi %"struct.pov::Media_Struct"* [ %205, %203 ], [ %198, %.preheader15 ]
  %200 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.150, i64 0, i32 23, !dbg !2613
  %201 = load i32* %200, align 4, !dbg !2613, !tbaa !1904
  %202 = icmp eq i32 %201, 0, !dbg !2615
  br i1 %202, label %._crit_edge52, label %203, !dbg !2616

; <label>:203                                     ; preds = %.lr.ph51
  %204 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.150, i64 0, i32 25, !dbg !2617
  %205 = load %"struct.pov::Media_Struct"** %204, align 8, !dbg !2617, !tbaa !1908
  call void @llvm.dbg.value(metadata %"struct.pov::Media_Struct"* %205, i64 0, metadata !1226, metadata !1851), !dbg !2554
  %206 = icmp eq %"struct.pov::Media_Struct"* %205, null, !dbg !2609
  br i1 %206, label %._crit_edge52, label %.lr.ph51, !dbg !2612

._crit_edge52:                                    ; preds = %203, %.lr.ph51, %.preheader15
  %ignore_photons.1 = phi i32 [ %ignore_photons.057, %.preheader15 ], [ %ignore_photons.057, %203 ], [ 0, %.lr.ph51 ]
  %207 = getelementptr inbounds %"struct.pov::Media_Struct"** %Tmp.156, i64 1, !dbg !2618
  call void @llvm.dbg.value(metadata %"struct.pov::Media_Struct"** %207, i64 0, metadata !1225, metadata !1851), !dbg !2461
  %208 = load %"struct.pov::Media_Struct"** %207, align 8, !dbg !2604, !tbaa !1870
  %209 = icmp eq %"struct.pov::Media_Struct"* %208, null, !dbg !2607
  br i1 %209, label %._crit_edge58, label %.preheader15, !dbg !2608

._crit_edge58:                                    ; preds = %._crit_edge52
  %210 = icmp eq i32 %ignore_photons.1, 0, !dbg !2619
  br i1 %210, label %211, label %._crit_edge58.thread, !dbg !2621

._crit_edge58.thread:                             ; preds = %195, %._crit_edge58
  store i32 44040192, i32* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 26), align 4, !dbg !2622, !tbaa !2601
  br label %211, !dbg !2623

; <label>:211                                     ; preds = %._crit_edge58, %._crit_edge58.thread
  store %"struct.pov::Object_Struct"* null, %"struct.pov::Object_Struct"** getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 18), align 8, !dbg !2624, !tbaa !2625
  br label %.preheader14, !dbg !2626

.preheader14:                                     ; preds = %192, %211
  %212 = icmp sgt i32 %global_light_list_cnt, 0, !dbg !2627
  br i1 %212, label %.lr.ph49, label %.preheader, !dbg !2630

.lr.ph49:                                         ; preds = %.preheader14
  %213 = getelementptr inbounds [3 x double]* %P, i64 0, i64 0, !dbg !2631
  %214 = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 0, !dbg !2636
  %215 = add i32 %global_light_list_cnt, -1, !dbg !2630
  br label %220, !dbg !2630

.preheader:                                       ; preds = %240, %.preheader14
  %216 = icmp sgt i32 %local_light_list_cnt, 0, !dbg !2637
  br i1 %216, label %.lr.ph47, label %.loopexit, !dbg !2640

.lr.ph47:                                         ; preds = %.preheader
  %217 = getelementptr inbounds [3 x double]* %P, i64 0, i64 0, !dbg !2641
  %218 = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 0, !dbg !2646
  %219 = add i32 %local_light_list_cnt, -1, !dbg !2640
  br label %241, !dbg !2640

; <label>:220                                     ; preds = %240, %.lr.ph49
  %indvars.iv98 = phi i64 [ 0, %.lr.ph49 ], [ %indvars.iv.next99, %240 ]
  %221 = getelementptr inbounds %"struct.pov::Light_List_Struct"* %light_list, i64 %indvars.iv98, i32 0, !dbg !2647
  %222 = load i8* %221, align 1, !dbg !2647, !tbaa !2648, !range !2650
  %223 = icmp eq i8 %222, 0, !dbg !2647
  br i1 %223, label %240, label %224, !dbg !2651

; <label>:224                                     ; preds = %220
  %225 = getelementptr inbounds %"struct.pov::Light_List_Struct"* %light_list, i64 %indvars.iv98, i32 1, !dbg !2652
  %226 = load double* %225, align 8, !dbg !2652, !tbaa !2653
  %227 = fcmp ult double %9, %226, !dbg !2654
  br i1 %227, label %240, label %228, !dbg !2655

; <label>:228                                     ; preds = %224
  %229 = getelementptr inbounds %"struct.pov::Light_List_Struct"* %light_list, i64 %indvars.iv98, i32 2, !dbg !2656
  %230 = load double* %229, align 8, !dbg !2656, !tbaa !2657
  %231 = fcmp ugt double %9, %230, !dbg !2658
  br i1 %231, label %240, label %232, !dbg !2659

; <label>:232                                     ; preds = %228
  %233 = getelementptr inbounds %"struct.pov::Light_List_Struct"* %light_list, i64 %indvars.iv98, i32 3, !dbg !2660
  %234 = load %"struct.pov::Light_Source_Struct"** %233, align 8, !dbg !2660, !tbaa !2661
  %235 = getelementptr inbounds %"struct.pov::Light_Source_Struct"* %234, i64 0, i32 13, !dbg !2662
  %236 = load i32* %235, align 4, !dbg !2662, !tbaa !2663
  store i32 %236, i32* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 25), align 8, !dbg !2664, !tbaa !2665
  call void @llvm.dbg.value(metadata double* %len, i64 0, metadata !1215, metadata !1851), !dbg !2666
  call void @llvm.dbg.value(metadata %"struct.pov::Ray_Struct"* %Light_Ray, i64 0, metadata !1224, metadata !1851), !dbg !2667
  %237 = call i32 @_ZN3pov11Test_ShadowEPNS_19Light_Source_StructEPdPNS_10Ray_StructES4_S2_Pf(%"struct.pov::Light_Source_Struct"* %234, double* %len, %"struct.pov::Ray_Struct"* %Light_Ray, %"struct.pov::Ray_Struct"* %Ray, double* %213, float* %214) #7, !dbg !2668
  %238 = icmp eq i32 %237, 0, !dbg !2669
  br i1 %238, label %239, label %240, !dbg !2670

; <label>:239                                     ; preds = %232
  call void @llvm.dbg.value(metadata %"struct.pov::Ray_Struct"* %Light_Ray, i64 0, metadata !1224, metadata !1851), !dbg !2667
  call fastcc void @_ZN3povL22scattering_attenuationEPPNS_12Media_StructEPfS3_S3_PNS_10Ray_StructES5_(%"struct.pov::Media_Struct"** %Media_List, float* %180, float* %28, float* %214, %"struct.pov::Ray_Struct"* %Ray, %"struct.pov::Ray_Struct"* %Light_Ray) #7, !dbg !2671
  br label %240, !dbg !2673

; <label>:240                                     ; preds = %232, %228, %224, %220, %239
  %indvars.iv.next99 = add nuw nsw i64 %indvars.iv98, 1, !dbg !2630
  %lftr.wideiv100 = trunc i64 %indvars.iv98 to i32, !dbg !2630
  %exitcond101 = icmp eq i32 %lftr.wideiv100, %215, !dbg !2630
  br i1 %exitcond101, label %.preheader, label %220, !dbg !2630

; <label>:241                                     ; preds = %261, %.lr.ph47
  %indvars.iv94 = phi i64 [ 0, %.lr.ph47 ], [ %indvars.iv.next95, %261 ]
  %242 = getelementptr inbounds %"struct.pov::Light_List_Struct"* %local_light_list, i64 %indvars.iv94, i32 0, !dbg !2674
  %243 = load i8* %242, align 1, !dbg !2674, !tbaa !2648, !range !2650
  %244 = icmp eq i8 %243, 0, !dbg !2674
  br i1 %244, label %261, label %245, !dbg !2675

; <label>:245                                     ; preds = %241
  %246 = getelementptr inbounds %"struct.pov::Light_List_Struct"* %local_light_list, i64 %indvars.iv94, i32 1, !dbg !2676
  %247 = load double* %246, align 8, !dbg !2676, !tbaa !2653
  %248 = fcmp ult double %9, %247, !dbg !2677
  br i1 %248, label %261, label %249, !dbg !2678

; <label>:249                                     ; preds = %245
  %250 = getelementptr inbounds %"struct.pov::Light_List_Struct"* %local_light_list, i64 %indvars.iv94, i32 2, !dbg !2679
  %251 = load double* %250, align 8, !dbg !2679, !tbaa !2657
  %252 = fcmp ugt double %9, %251, !dbg !2680
  br i1 %252, label %261, label %253, !dbg !2681

; <label>:253                                     ; preds = %249
  %254 = getelementptr inbounds %"struct.pov::Light_List_Struct"* %local_light_list, i64 %indvars.iv94, i32 3, !dbg !2682
  %255 = load %"struct.pov::Light_Source_Struct"** %254, align 8, !dbg !2682, !tbaa !2661
  %256 = getelementptr inbounds %"struct.pov::Light_Source_Struct"* %255, i64 0, i32 13, !dbg !2683
  %257 = load i32* %256, align 4, !dbg !2683, !tbaa !2663
  store i32 %257, i32* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 25), align 8, !dbg !2684, !tbaa !2665
  call void @llvm.dbg.value(metadata double* %len, i64 0, metadata !1215, metadata !1851), !dbg !2666
  call void @llvm.dbg.value(metadata %"struct.pov::Ray_Struct"* %Light_Ray, i64 0, metadata !1224, metadata !1851), !dbg !2667
  %258 = call i32 @_ZN3pov11Test_ShadowEPNS_19Light_Source_StructEPdPNS_10Ray_StructES4_S2_Pf(%"struct.pov::Light_Source_Struct"* %255, double* %len, %"struct.pov::Ray_Struct"* %Light_Ray, %"struct.pov::Ray_Struct"* %Ray, double* %217, float* %218) #7, !dbg !2685
  %259 = icmp eq i32 %258, 0, !dbg !2686
  br i1 %259, label %260, label %261, !dbg !2687

; <label>:260                                     ; preds = %253
  call void @llvm.dbg.value(metadata %"struct.pov::Ray_Struct"* %Light_Ray, i64 0, metadata !1224, metadata !1851), !dbg !2667
  call fastcc void @_ZN3povL22scattering_attenuationEPPNS_12Media_StructEPfS3_S3_PNS_10Ray_StructES5_(%"struct.pov::Media_Struct"** %Media_List, float* %180, float* %28, float* %218, %"struct.pov::Ray_Struct"* %Ray, %"struct.pov::Ray_Struct"* %Light_Ray) #7, !dbg !2688
  br label %261, !dbg !2690

; <label>:261                                     ; preds = %253, %249, %245, %241, %260
  %indvars.iv.next95 = add nuw nsw i64 %indvars.iv94, 1, !dbg !2640
  %lftr.wideiv96 = trunc i64 %indvars.iv94 to i32, !dbg !2640
  %exitcond97 = icmp eq i32 %lftr.wideiv96, %219, !dbg !2640
  br i1 %exitcond97, label %.loopexit, label %241, !dbg !2640

.loopexit:                                        ; preds = %261, %.preheader, %188
  %262 = load i32* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 29, i32 2), align 4
  %263 = icmp sgt i32 %262, 0, !dbg !2691
  br i1 %263, label %264, label %.thread, !dbg !2692

; <label>:264                                     ; preds = %.loopexit
  call void @llvm.dbg.value(metadata i32 0, i64 0, metadata !1235, metadata !1851), !dbg !2693
  call void @llvm.dbg.value(metadata double 0.000000e+00, i64 0, metadata !1238, metadata !1851), !dbg !2694
  call void @llvm.dbg.value(metadata double 0.000000e+00, i64 0, metadata !1239, metadata !1851), !dbg !2695
  store double 0.000000e+00, double* %tempr, align 8, !dbg !2695, !tbaa !2166
  call void @llvm.dbg.value(metadata double 0.000000e+00, i64 0, metadata !1240, metadata !1851), !dbg !2696
  call void @llvm.dbg.value(metadata double 1.000000e-16, i64 0, metadata !1241, metadata !1851), !dbg !2697
  call void @llvm.dbg.value(metadata i32 0, i64 0, metadata !1242, metadata !1851), !dbg !2698
  call void @llvm.dbg.declare(metadata [5 x float]* undef, metadata !1243, metadata !1851), !dbg !2699
  call void @llvm.dbg.declare(metadata [5 x float]* %TempCol, metadata !1244, metadata !1851), !dbg !2700
  call void @llvm.dbg.value(metadata double %270, i64 0, metadata !1237, metadata !1851), !dbg !2701
  tail call void @llvm.dbg.value(metadata float* undef, i64 0, metadata !1157, metadata !1851), !dbg !2702
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1158, metadata !1851), !dbg !2704
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1159, metadata !1851), !dbg !2705
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1160, metadata !1851), !dbg !2706
  call void @llvm.dbg.value(metadata i32 0, i64 0, metadata !1243, metadata !1981), !dbg !2699
  call void @llvm.dbg.value(metadata i32 -1, i64 0, metadata !1228, metadata !1851), !dbg !2707
  call void @llvm.dbg.value(metadata i32 0, i64 0, metadata !1235, metadata !1851), !dbg !2693
  %265 = load i32* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 9), align 8, !dbg !2708, !tbaa !2709
  call void @llvm.dbg.value(metadata i32 %265, i64 0, metadata !1236, metadata !1851), !dbg !2710
  %266 = icmp sgt i32 %265, -1, !dbg !2711
  %267 = load i32* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 29, i32 6), align 8
  %268 = icmp sgt i32 %267, 0, !dbg !2712
  %or.cond1235 = and i1 %266, %268, !dbg !2713
  br i1 %or.cond1235, label %269, label %.critedge, !dbg !2713

; <label>:269                                     ; preds = %264
  %270 = load double* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 29, i32 3), align 8, !dbg !2714, !tbaa !2715
  %271 = getelementptr inbounds [5 x float]* %TempCol, i64 0, i64 0, !dbg !2716
  %272 = getelementptr inbounds [5 x float]* %TempCol, i64 0, i64 2, !dbg !2717
  %273 = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 0, !dbg !2719
  %274 = getelementptr inbounds %"struct.pov::Ray_Struct"* %Light_Ray, i64 0, i32 1, i64 1, !dbg !2720
  %275 = bitcast double* %274 to i64*, !dbg !2721
  %276 = getelementptr inbounds %"struct.pov::Ray_Struct"* %Light_Ray, i64 0, i32 1, i64 0, !dbg !2722
  %277 = getelementptr inbounds %"struct.pov::Ray_Struct"* %Light_Ray, i64 0, i32 1, i64 2, !dbg !2723
  %278 = getelementptr inbounds %"struct.pov::Ray_Struct"* %Light_Ray, i64 0, i32 0, i64 2, !dbg !2724
  tail call void @llvm.dbg.value(metadata float* %271, i64 0, metadata !1157, metadata !1851), !dbg !2726
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1158, metadata !1851), !dbg !2727
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1159, metadata !1851), !dbg !2728
  tail call void @llvm.dbg.value(metadata float 0.000000e+00, i64 0, metadata !1160, metadata !1851), !dbg !2729
  call void @llvm.dbg.value(metadata double 0.000000e+00, i64 0, metadata !1239, metadata !1851), !dbg !2695
  %279 = bitcast [5 x float]* %TempCol to i8*, !dbg !2730
  call void @llvm.memset.p0i8.i64(i8* %279, i8 0, i64 20, i32 16, i1 false), !dbg !2731
  store double 0.000000e+00, double* %tempr, align 8, !dbg !2730, !tbaa !2166
  call void @llvm.dbg.value(metadata double* %tempr, i64 0, metadata !1239, metadata !1851), !dbg !2695
  %280 = call i32 @_ZN3pov13gatherPhotonsEPddS0_S0_iPNS_17photon_map_structE(double* %10, double %270, double* %tempr, double* null, i32 0, %"struct.pov::photon_map_struct"* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 29)) #7, !dbg !2732
  call void @llvm.dbg.value(metadata i32 %280, i64 0, metadata !1233, metadata !1851), !dbg !2733
  call void @llvm.dbg.value(metadata i32 0, i64 0, metadata !1234, metadata !1851), !dbg !2734
  %281 = icmp sgt i32 %280, 0, !dbg !2735
  br i1 %281, label %.lr.ph, label %..critedge_crit_edge, !dbg !2736

.lr.ph:                                           ; preds = %269
  %282 = add i32 %280, -1, !dbg !2736
  br label %283, !dbg !2736

; <label>:283                                     ; preds = %283, %.lr.ph
  %indvars.iv = phi i64 [ 0, %.lr.ph ], [ %indvars.iv.next, %283 ]
  %284 = load %"struct.pov::photon_struct"*** getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 21), align 8, !dbg !2737, !tbaa !2738
  %285 = getelementptr inbounds %"struct.pov::photon_struct"** %284, i64 %indvars.iv, !dbg !2739
  %286 = load %"struct.pov::photon_struct"** %285, align 8, !dbg !2739, !tbaa !1870
  %287 = getelementptr inbounds %"struct.pov::photon_struct"* %286, i64 0, i32 1, i64 0, !dbg !2739
  call void @_ZN3pov17photonRgbe2colourEPfPh(float* %273, i8* %287) #7, !dbg !2740
  %288 = load %"struct.pov::photon_struct"*** getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 21), align 8, !dbg !2741, !tbaa !2738
  %289 = getelementptr inbounds %"struct.pov::photon_struct"** %288, i64 %indvars.iv, !dbg !2742
  %290 = load %"struct.pov::photon_struct"** %289, align 8, !dbg !2742, !tbaa !1870
  %291 = getelementptr inbounds %"struct.pov::photon_struct"* %290, i64 0, i32 3, !dbg !2743
  %292 = load i8* %291, align 1, !dbg !2743, !tbaa !2744
  %293 = sext i8 %292 to i64, !dbg !2742
  %294 = add nsw i64 %293, 127, !dbg !2746
  %295 = getelementptr inbounds %"struct.pov::photon_struct"* %290, i64 0, i32 4, !dbg !2747
  %296 = load i8* %295, align 1, !dbg !2747, !tbaa !2748
  %297 = sext i8 %296 to i64, !dbg !2749
  %298 = add nsw i64 %297, 127, !dbg !2750
  %299 = load double** getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 20), align 8, !dbg !2751, !tbaa !2752
  %300 = getelementptr inbounds double* %299, i64 %294, !dbg !2753
  %301 = bitcast double* %300 to i64*, !dbg !2753
  %302 = load i64* %301, align 8, !dbg !2753, !tbaa !2166
  store i64 %302, i64* %275, align 8, !dbg !2721, !tbaa !2166
  %303 = load double** getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 19), align 8, !dbg !2754, !tbaa !2755
  %304 = getelementptr inbounds double* %303, i64 %294, !dbg !2756
  %305 = load double* %304, align 8, !dbg !2756, !tbaa !2166
  store double %305, double* %276, align 8, !dbg !2757, !tbaa !2166
  %306 = getelementptr inbounds double* %299, i64 %298, !dbg !2758
  %307 = load double* %306, align 8, !dbg !2758, !tbaa !2166
  %308 = fmul double %305, %307, !dbg !2759
  store double %308, double* %277, align 8, !dbg !2760, !tbaa !2166
  %309 = getelementptr inbounds double* %303, i64 %298, !dbg !2761
  %310 = load double* %309, align 8, !dbg !2761, !tbaa !2166
  %311 = fmul double %305, %310, !dbg !2762
  store double %311, double* %276, align 8, !dbg !2763, !tbaa !2166
  tail call void @llvm.dbg.value(metadata double* %276, i64 0, metadata !1297, metadata !1851), !dbg !2764
  %312 = bitcast %"struct.pov::photon_struct"* %290 to <2 x float>*, !dbg !2765
  %313 = load <2 x float>* %312, align 4, !dbg !2765, !tbaa !1991
  %314 = fpext <2 x float> %313 to <2 x double>, !dbg !2765
  %315 = bitcast i64 %302 to double
  %316 = insertelement <2 x double> undef, double %311, i32 0, !dbg !2766
  %317 = insertelement <2 x double> %316, double %315, i32 1, !dbg !2766
  %318 = fsub <2 x double> %314, %317, !dbg !2766
  %319 = bitcast %"struct.pov::Ray_Struct"* %Light_Ray to <2 x double>*, !dbg !2767
  store <2 x double> %318, <2 x double>* %319, align 16, !dbg !2767, !tbaa !2166
  %320 = getelementptr inbounds %"struct.pov::photon_struct"* %290, i64 0, i32 0, i64 2, !dbg !2768
  %321 = load float* %320, align 4, !dbg !2768, !tbaa !1991
  %322 = fpext float %321 to double, !dbg !2768
  %323 = fsub double %322, %308, !dbg !2769
  store double %323, double* %278, align 16, !dbg !2770, !tbaa !2166
  call void @llvm.dbg.value(metadata %"struct.pov::Ray_Struct"* %Light_Ray, i64 0, metadata !1224, metadata !1851), !dbg !2667
  call fastcc void @_ZN3povL22scattering_attenuationEPPNS_12Media_StructEPfS3_S3_PNS_10Ray_StructES5_(%"struct.pov::Media_Struct"** %Media_List, float* %271, float* %28, float* %273, %"struct.pov::Ray_Struct"* %Ray, %"struct.pov::Ray_Struct"* %Light_Ray) #7, !dbg !2771
  %indvars.iv.next = add nuw nsw i64 %indvars.iv, 1, !dbg !2736
  %lftr.wideiv = trunc i64 %indvars.iv to i32, !dbg !2736
  %exitcond = icmp eq i32 %lftr.wideiv, %282, !dbg !2736
  br i1 %exitcond, label %..critedge_crit_edge, label %283, !dbg !2736

..critedge_crit_edge:                             ; preds = %283, %269
  call void @llvm.dbg.value(metadata double* %tempr, i64 0, metadata !1239, metadata !1851), !dbg !2695
  %324 = load double* %tempr, align 8, !dbg !2772, !tbaa !2166
  call void @llvm.dbg.value(metadata double 1.000000e-16, i64 0, metadata !1241, metadata !1851), !dbg !2697
  tail call void @llvm.dbg.value(metadata float* undef, i64 0, metadata !1302, metadata !1851), !dbg !2773
  tail call void @llvm.dbg.value(metadata float* %271, i64 0, metadata !1303, metadata !1851), !dbg !2777
  %325 = bitcast [5 x float]* %TempCol to i64*, !dbg !2778
  %326 = load i64* %325, align 16, !dbg !2778
  %327 = trunc i64 %326 to i32, !dbg !2778
  call void @llvm.dbg.value(metadata i32 %327, i64 0, metadata !1243, metadata !1981), !dbg !2699
  %328 = lshr i64 %326, 32
  %329 = trunc i64 %328 to i32
  call void @llvm.dbg.value(metadata i32 %329, i64 0, metadata !1243, metadata !1983), !dbg !2699
  %330 = load float* %272, align 8, !dbg !2779, !tbaa !1991
  call void @llvm.dbg.value(metadata double* %tempr, i64 0, metadata !1239, metadata !1851), !dbg !2695
  call void @llvm.dbg.value(metadata double %324, i64 0, metadata !1238, metadata !1851), !dbg !2694
  call void @llvm.dbg.value(metadata i32 %280, i64 0, metadata !1228, metadata !1851), !dbg !2707
  %phitmp = bitcast i32 %327 to float, !dbg !2713
  %phitmp106 = bitcast i32 %329 to float, !dbg !2713
  br label %.critedge, !dbg !2713

.critedge:                                        ; preds = %..critedge_crit_edge, %264
  %r.0.lcssa = phi double [ %324, %..critedge_crit_edge ], [ 0.000000e+00, %264 ]
  %.lcssa18 = phi float [ %phitmp, %..critedge_crit_edge ], [ 0.000000e+00, %264 ]
  %.lcssa17 = phi float [ %phitmp106, %..critedge_crit_edge ], [ 0.000000e+00, %264 ]
  %.lcssa = phi float [ %330, %..critedge_crit_edge ], [ 0.000000e+00, %264 ]
  %331 = fmul double %r.0.lcssa, 0x400921FB54442D18, !dbg !2780
  %332 = fmul double %r.0.lcssa, %331, !dbg !2781
  %333 = fmul double %r.0.lcssa, %332, !dbg !2782
  %334 = fmul double %333, 4.000000e+00, !dbg !2783
  %335 = fdiv double 3.000000e+00, %334, !dbg !2784
  %336 = fptrunc double %335 to float, !dbg !2785
  tail call void @llvm.dbg.value(metadata float* undef, i64 0, metadata !1308, metadata !1851), !dbg !2786
  tail call void @llvm.dbg.value(metadata float %336, i64 0, metadata !1309, metadata !1851), !dbg !2788
  %337 = fmul float %.lcssa18, %336, !dbg !2789
  %338 = fmul float %.lcssa17, %336, !dbg !2790
  %339 = fmul float %.lcssa, %336, !dbg !2791
  %340 = load float* %180, align 16, !dbg !2792, !tbaa !1991
  %341 = fadd float %340, %337, !dbg !2792
  store float %341, float* %180, align 16, !dbg !2792, !tbaa !1991
  %342 = load float* %182, align 4, !dbg !2793, !tbaa !1991
  %343 = fadd float %342, %338, !dbg !2793
  store float %343, float* %182, align 4, !dbg !2793, !tbaa !1991
  %344 = load float* %184, align 8, !dbg !2794, !tbaa !1991
  %345 = fadd float %339, %344, !dbg !2794
  store float %345, float* %184, align 8, !dbg !2794, !tbaa !1991
  br label %.thread, !dbg !2795

.thread:                                          ; preds = %179, %.critedge, %.loopexit
  %346 = icmp eq i32 %sample_method, 3, !dbg !2796
  %347 = load double* %4, align 8, !dbg !2798, !tbaa !2035
  %348 = load float* %180, align 16, !dbg !2800, !tbaa !1991
  br i1 %346, label %349, label %363, !dbg !2801

; <label>:349                                     ; preds = %.thread
  %350 = load float* %182, align 4, !dbg !2802, !tbaa !1991
  %351 = insertelement <2 x float> undef, float %350, i32 0, !dbg !2802
  %352 = insertelement <2 x float> %351, float %348, i32 1, !dbg !2802
  %353 = fpext <2 x float> %352 to <2 x double>, !dbg !2802
  %354 = insertelement <2 x double> undef, double %347, i32 0, !dbg !2802
  %355 = insertelement <2 x double> %354, double %347, i32 1, !dbg !2802
  %356 = fmul <2 x double> %355, %353, !dbg !2802
  %357 = fptrunc <2 x double> %356 to <2 x float>, !dbg !2802
  %358 = extractelement <2 x float> %357, i32 1, !dbg !2800
  store float %358, float* %180, align 16, !dbg !2800, !tbaa !1991
  %359 = extractelement <2 x float> %357, i32 0, !dbg !2802
  store float %359, float* %182, align 4, !dbg !2802, !tbaa !1991
  %360 = load float* %184, align 8, !dbg !2803, !tbaa !1991
  %361 = fpext float %360 to double, !dbg !2803
  %362 = fmul double %347, %361, !dbg !2803
  br label %389, !dbg !2804

; <label>:363                                     ; preds = %.thread
  %364 = fsub <2 x float> <float -0.000000e+00, float -0.000000e+00>, %152, !dbg !2805
  %365 = fpext <2 x float> %364 to <2 x double>, !dbg !2805
  %366 = insertelement <2 x double> undef, double %6, i32 0, !dbg !2807
  %367 = insertelement <2 x double> %366, double %6, i32 1, !dbg !2807
  %368 = fmul <2 x double> %367, %365, !dbg !2807
  %369 = call <2 x double> @llvm.exp.v2f64(<2 x double> %368), !dbg !2808
  %370 = insertelement <2 x double> undef, double %347, i32 0, !dbg !2809
  %371 = insertelement <2 x double> %370, double %347, i32 1, !dbg !2809
  %372 = fmul <2 x double> %371, %369, !dbg !2809
  %373 = load float* %182, align 4, !dbg !2810, !tbaa !1991
  %374 = insertelement <2 x float> undef, float %373, i32 0, !dbg !2810
  %375 = insertelement <2 x float> %374, float %348, i32 1, !dbg !2810
  %376 = fpext <2 x float> %375 to <2 x double>, !dbg !2810
  %377 = fmul <2 x double> %372, %376, !dbg !2810
  %378 = fptrunc <2 x double> %377 to <2 x float>, !dbg !2810
  %379 = extractelement <2 x float> %378, i32 1, !dbg !2811
  store float %379, float* %180, align 16, !dbg !2811, !tbaa !1991
  %380 = extractelement <2 x float> %378, i32 0, !dbg !2810
  store float %380, float* %182, align 4, !dbg !2810, !tbaa !1991
  %381 = fsub float -0.000000e+00, %.lcssa31, !dbg !2812
  %382 = fpext float %381 to double, !dbg !2812
  %383 = fmul double %6, %382, !dbg !2813
  %384 = call double @exp(double %383) #8, !dbg !2814
  %385 = fmul double %347, %384, !dbg !2815
  %386 = load float* %184, align 8, !dbg !2816, !tbaa !1991
  %387 = fpext float %386 to double, !dbg !2816
  %388 = fmul double %385, %387, !dbg !2816
  br label %389

; <label>:389                                     ; preds = %363, %349
  %storemerge.in = phi double [ %362, %349 ], [ %388, %363 ]
  %390 = phi <2 x float> [ %357, %349 ], [ %378, %363 ]
  %storemerge = fptrunc double %storemerge.in to float, !dbg !2803
  store float %storemerge, float* %184, align 8, !dbg !2816, !tbaa !1991
  %391 = extractelement <2 x float> %390, i32 1, !dbg !2817
  store float %391, float* %SampCol, align 4, !dbg !2817, !tbaa !1991
  %392 = getelementptr inbounds float* %SampCol, i64 1, !dbg !2818
  %393 = extractelement <2 x float> %390, i32 0, !dbg !2819
  store float %393, float* %392, align 4, !dbg !2819, !tbaa !1991
  %394 = getelementptr inbounds float* %SampCol, i64 2, !dbg !2820
  store float %storemerge, float* %394, align 4, !dbg !2821, !tbaa !1991
  br i1 %166, label %395, label %417, !dbg !2822

; <label>:395                                     ; preds = %389
  %396 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Interval, i64 0, i32 6, i64 0, !dbg !2823
  %397 = load float* %396, align 4, !dbg !2826, !tbaa !1991
  %398 = fadd float %391, %397, !dbg !2826
  store float %398, float* %396, align 4, !dbg !2826, !tbaa !1991
  %399 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Interval, i64 0, i32 6, i64 1, !dbg !2827
  %400 = load float* %399, align 4, !dbg !2828, !tbaa !1991
  %401 = fadd float %393, %400, !dbg !2828
  store float %401, float* %399, align 4, !dbg !2828, !tbaa !1991
  %402 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Interval, i64 0, i32 6, i64 2, !dbg !2829
  %403 = load float* %402, align 4, !dbg !2830, !tbaa !1991
  %404 = fadd float %storemerge, %403, !dbg !2830
  store float %404, float* %402, align 4, !dbg !2830, !tbaa !1991
  tail call void @llvm.dbg.value(metadata float undef, i64 0, metadata !1314, metadata !1851), !dbg !2831
  %405 = fmul float %391, %391, !dbg !2833
  %406 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Interval, i64 0, i32 7, i64 0, !dbg !2834
  %407 = load float* %406, align 4, !dbg !2835, !tbaa !1991
  %408 = fadd float %407, %405, !dbg !2835
  store float %408, float* %406, align 4, !dbg !2835, !tbaa !1991
  tail call void @llvm.dbg.value(metadata float undef, i64 0, metadata !1314, metadata !1851), !dbg !2836
  %409 = fmul float %393, %393, !dbg !2838
  %410 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Interval, i64 0, i32 7, i64 1, !dbg !2839
  %411 = load float* %410, align 4, !dbg !2840, !tbaa !1991
  %412 = fadd float %411, %409, !dbg !2840
  store float %412, float* %410, align 4, !dbg !2840, !tbaa !1991
  tail call void @llvm.dbg.value(metadata float %storemerge, i64 0, metadata !1314, metadata !1851), !dbg !2841
  %413 = fmul float %storemerge, %storemerge, !dbg !2843
  %414 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Interval, i64 0, i32 7, i64 2, !dbg !2844
  %415 = load float* %414, align 4, !dbg !2845, !tbaa !1991
  %416 = fadd float %415, %413, !dbg !2845
  store float %416, float* %414, align 4, !dbg !2845, !tbaa !1991
  br label %417, !dbg !2846

; <label>:417                                     ; preds = %395, %389
  %418 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Interval, i64 0, i32 1, !dbg !2847
  %419 = load i32* %418, align 4, !dbg !2848, !tbaa !2185
  %420 = add nsw i32 %419, 1, !dbg !2848
  store i32 %420, i32* %418, align 4, !dbg !2848, !tbaa !2185
  call void @llvm.lifetime.end(i64 856, i8* %1) #4, !dbg !2849
  ret void, !dbg !2849
}
