define void @_ZN3pov24Backtrace_Simulate_MediaEPPNS_12Media_StructEPNS_10Ray_StructEPNS_10istk_entryEPf(%"struct.pov::Media_Struct"** readonly %Media_List, %"struct.pov::Ray_Struct"* %Ray, %"struct.pov::istk_entry"* nocapture readonly %Inter, float* nocapture %Colour) #0 {
  %C0 = alloca [5 x float], align 16
  %od0 = alloca [5 x float], align 16
  %PhotonColour = alloca [5 x float], align 16
  %TempPoint = alloca [3 x double], align 16
  tail call void @llvm.dbg.value(metadata %"struct.pov::Media_Struct"** %Media_List, i64 0, metadata !1014, metadata !1851), !dbg !1852
  tail call void @llvm.dbg.value(metadata %"struct.pov::Ray_Struct"* %Ray, i64 0, metadata !1015, metadata !1851), !dbg !1853
  tail call void @llvm.dbg.value(metadata %"struct.pov::istk_entry"* %Inter, i64 0, metadata !1016, metadata !1851), !dbg !1854
  tail call void @llvm.dbg.value(metadata float* %Colour, i64 0, metadata !1017, metadata !1851), !dbg !1855
  tail call void @llvm.dbg.declare(metadata [5 x float]* undef, metadata !1025, metadata !1851), !dbg !1856
  tail call void @llvm.dbg.declare(metadata [5 x float]* %C0, metadata !1036, metadata !1851), !dbg !1857
  tail call void @llvm.dbg.declare(metadata [5 x float]* %od0, metadata !1037, metadata !1851), !dbg !1858
  tail call void @llvm.dbg.declare(metadata [5 x float]* %PhotonColour, metadata !1038, metadata !1851), !dbg !1859
  tail call void @llvm.dbg.declare(metadata [3 x double]* %TempPoint, metadata !1039, metadata !1851), !dbg !1860
  %1 = load i64* @_ZN3pov14MediaPoolIndexE, align 8, !dbg !1861, !tbaa !1862
  %2 = add nsw i64 %1, 1, !dbg !1861
  store i64 %2, i64* @_ZN3pov14MediaPoolIndexE, align 8, !dbg !1861, !tbaa !1862
  %3 = icmp eq %"struct.pov::Media_Struct"** %Media_List, null, !dbg !1866
  br i1 %3, label %7, label %4, !dbg !1868

; <label>:4                                       ; preds = %0
  %5 = load %"struct.pov::Media_Struct"** %Media_List, align 8, !dbg !1869, !tbaa !1870
  %6 = icmp eq %"struct.pov::Media_Struct"* %5, null, !dbg !1872
  br i1 %6, label %7, label %.preheader5, !dbg !1873

; <label>:7                                       ; preds = %4, %0
  store i64 %1, i64* @_ZN3pov14MediaPoolIndexE, align 8, !dbg !1874, !tbaa !1862
  br label %308, !dbg !1876

.preheader5:                                      ; preds = %4, %._crit_edge33
  %8 = phi %"struct.pov::Media_Struct"* [ %26, %._crit_edge33 ], [ %5, %4 ]
  %Tmp.044 = phi %"struct.pov::Media_Struct"** [ %25, %._crit_edge33 ], [ %Media_List, %4 ]
  %IMedia.043 = phi %"struct.pov::Media_Struct"* [ %IMedia.1.lcssa, %._crit_edge33 ], [ %5, %4 ]
  %intervals.042 = phi i32 [ %intervals.1.lcssa, %._crit_edge33 ], [ 0, %4 ]
  %ignore_photons.041 = phi i32 [ %ignore_photons.1.lcssa, %._crit_edge33 ], [ 1, %4 ]
  %use_scattering.040 = phi i32 [ %use_scattering.1.lcssa, %._crit_edge33 ], [ 0, %4 ]
  %use_extinction.039 = phi i32 [ %use_extinction.1.lcssa, %._crit_edge33 ], [ 0, %4 ]
  %9 = icmp eq %"struct.pov::Media_Struct"* %8, null, !dbg !1877
  br i1 %9, label %._crit_edge33, label %.lr.ph32, !dbg !1883

.lr.ph32:                                         ; preds = %.preheader5, %.lr.ph32
  %Local.031 = phi %"struct.pov::Media_Struct"* [ %23, %.lr.ph32 ], [ %8, %.preheader5 ]
  %IMedia.130 = phi %"struct.pov::Media_Struct"* [ %Local.0.IMedia.1, %.lr.ph32 ], [ %IMedia.043, %.preheader5 ]
  %intervals.129 = phi i32 [ %.intervals.1, %.lr.ph32 ], [ %intervals.042, %.preheader5 ]
  %ignore_photons.128 = phi i32 [ %21, %.lr.ph32 ], [ %ignore_photons.041, %.preheader5 ]
  %use_scattering.127 = phi i32 [ %18, %.lr.ph32 ], [ %use_scattering.040, %.preheader5 ]
  %use_extinction.126 = phi i32 [ %15, %.lr.ph32 ], [ %use_extinction.039, %.preheader5 ]
  %10 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.031, i64 0, i32 1, !dbg !1884
  %11 = load i32* %10, align 4, !dbg !1884, !tbaa !1887
  %12 = icmp sgt i32 %11, %intervals.129, !dbg !1891
  tail call void @llvm.dbg.value(metadata i32 %11, i64 0, metadata !1020, metadata !1851), !dbg !1892
  tail call void @llvm.dbg.value(metadata %"struct.pov::Media_Struct"* %23, i64 0, metadata !1029, metadata !1851), !dbg !1893
  %.intervals.1 = select i1 %12, i32 %11, i32 %intervals.129, !dbg !1894
  %Local.0.IMedia.1 = select i1 %12, %"struct.pov::Media_Struct"* %Local.031, %"struct.pov::Media_Struct"* %IMedia.130, !dbg !1894
  %13 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.031, i64 0, i32 11, !dbg !1895
  %14 = load i32* %13, align 4, !dbg !1895, !tbaa !1896
  %15 = or i32 %14, %use_extinction.126, !dbg !1897
  tail call void @llvm.dbg.value(metadata i32 %15, i64 0, metadata !1021, metadata !1851), !dbg !1898
  %16 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.031, i64 0, i32 12, !dbg !1899
  %17 = load i32* %16, align 4, !dbg !1899, !tbaa !1900
  %18 = or i32 %17, %use_scattering.127, !dbg !1901
  tail call void @llvm.dbg.value(metadata i32 %18, i64 0, metadata !1022, metadata !1851), !dbg !1902
  %19 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.031, i64 0, i32 23, !dbg !1903
  %20 = load i32* %19, align 4, !dbg !1903, !tbaa !1904
  %21 = and i32 %20, %ignore_photons.128, !dbg !1905
  tail call void @llvm.dbg.value(metadata i32 %21, i64 0, metadata !1023, metadata !1851), !dbg !1906
  %22 = getelementptr inbounds %"struct.pov::Media_Struct"* %Local.031, i64 0, i32 25, !dbg !1907
  %23 = load %"struct.pov::Media_Struct"** %22, align 8, !dbg !1907, !tbaa !1908
  tail call void @llvm.dbg.value(metadata %"struct.pov::Media_Struct"* %23, i64 0, metadata !1031, metadata !1851), !dbg !1909
  %24 = icmp eq %"struct.pov::Media_Struct"* %23, null, !dbg !1877
  br i1 %24, label %._crit_edge33, label %.lr.ph32, !dbg !1883

._crit_edge33:                                    ; preds = %.lr.ph32, %.preheader5
  %IMedia.1.lcssa = phi %"struct.pov::Media_Struct"* [ %IMedia.043, %.preheader5 ], [ %Local.0.IMedia.1, %.lr.ph32 ]
  %intervals.1.lcssa = phi i32 [ %intervals.042, %.preheader5 ], [ %.intervals.1, %.lr.ph32 ]
  %ignore_photons.1.lcssa = phi i32 [ %ignore_photons.041, %.preheader5 ], [ %21, %.lr.ph32 ]
  %use_scattering.1.lcssa = phi i32 [ %use_scattering.040, %.preheader5 ], [ %18, %.lr.ph32 ]
  %use_extinction.1.lcssa = phi i32 [ %use_extinction.039, %.preheader5 ], [ %15, %.lr.ph32 ]
  %25 = getelementptr inbounds %"struct.pov::Media_Struct"** %Tmp.044, i64 1, !dbg !1910
  tail call void @llvm.dbg.value(metadata %"struct.pov::Media_Struct"** %25, i64 0, metadata !1030, metadata !1851), !dbg !1911
  %26 = load %"struct.pov::Media_Struct"** %25, align 8, !dbg !1912, !tbaa !1870
  %27 = icmp eq %"struct.pov::Media_Struct"* %26, null, !dbg !1913
  br i1 %27, label %._crit_edge45, label %.preheader5, !dbg !1914

._crit_edge45:                                    ; preds = %._crit_edge33
  %28 = icmp eq i32 %use_extinction.1.lcssa, 0, !dbg !1915
  br i1 %28, label %29, label %30, !dbg !1917

; <label>:29                                      ; preds = %._crit_edge45
  store i64 %1, i64* @_ZN3pov14MediaPoolIndexE, align 8, !dbg !1918, !tbaa !1862
  br label %308, !dbg !1920

; <label>:30                                      ; preds = %._crit_edge45
  %31 = load i64* @_ZN3pov17MaxMediaPoolDepthE, align 8, !dbg !1921, !tbaa !1862
  %32 = icmp slt i64 %2, %31, !dbg !1923
  br i1 %32, label %35, label %33, !dbg !1924

; <label>:33                                      ; preds = %30
  %34 = shl nsw i64 %31, 1, !dbg !1925
  tail call void @_ZN3pov22ResizeMediaMallocPoolsEl(i64 %34) #7, !dbg !1927
  %.pre = load i64* @_ZN3pov14MediaPoolIndexE, align 8, !dbg !1928, !tbaa !1862
  br label %35, !dbg !1929

; <label>:35                                      ; preds = %30, %33
  %36 = phi i64 [ %2, %30 ], [ %.pre, %33 ]
  %37 = load %"struct.pov::Lit_Interval_Struct"*** @_ZN3pov20MediaLitIntervalPoolE, align 8, !dbg !1930, !tbaa !1870
  %38 = getelementptr inbounds %"struct.pov::Lit_Interval_Struct"** %37, i64 %36, !dbg !1930
  %39 = load %"struct.pov::Lit_Interval_Struct"** %38, align 8, !dbg !1930, !tbaa !1870
  tail call void @llvm.dbg.value(metadata %"struct.pov::Lit_Interval_Struct"* %39, i64 0, metadata !1026, metadata !1851), !dbg !1931
  tail call void @llvm.dbg.value(metadata i32 1, i64 0, metadata !1024, metadata !1851), !dbg !1932
  %40 = getelementptr inbounds %"struct.pov::Lit_Interval_Struct"* %39, i64 0, i32 0, !dbg !1933
  store i32 0, i32* %40, align 4, !dbg !1934, !tbaa !1935
  %41 = getelementptr inbounds %"struct.pov::Lit_Interval_Struct"* %39, i64 0, i32 1, !dbg !1937
  store double 0.000000e+00, double* %41, align 8, !dbg !1938, !tbaa !1939
  %42 = bitcast %"struct.pov::istk_entry"* %Inter to i64*, !dbg !1940
  %43 = load i64* %42, align 8, !dbg !1940, !tbaa !1941
  %44 = getelementptr inbounds %"struct.pov::Lit_Interval_Struct"* %39, i64 0, i32 3, !dbg !1943
  %45 = bitcast double* %44 to i64*, !dbg !1944
  store i64 %43, i64* %45, align 8, !dbg !1944, !tbaa !1945
  %46 = getelementptr inbounds %"struct.pov::Lit_Interval_Struct"* %39, i64 0, i32 2, !dbg !1946
  %47 = bitcast double* %46 to i64*, !dbg !1947
  store i64 %43, i64* %47, align 8, !dbg !1947, !tbaa !1948
  %48 = getelementptr inbounds %"struct.pov::Media_Struct"* %IMedia.1.lcssa, i64 0, i32 1, !dbg !1949
  %49 = load i32* %48, align 4, !dbg !1949, !tbaa !1887
  %50 = icmp slt i32 %49, 1, !dbg !1951
  br i1 %50, label %53, label %51, !dbg !1952

; <label>:51                                      ; preds = %35
  %52 = mul i32 %49, 96, !dbg !1953
  tail call void @llvm.dbg.value(metadata i32 %52, i64 0, metadata !1041, metadata !1851), !dbg !1954
  %phitmp = sext i32 %52 to i64
  br label %53

; <label>:53                                      ; preds = %35, %51
  %thesize.0 = phi i64 [ %phitmp, %51 ], [ 96, %35 ]
  %54 = load i64* @_ZN3pov17MaxMediaPoolDepthE, align 8, !dbg !1955, !tbaa !1862
  %55 = icmp slt i64 %36, %54, !dbg !1957
  br i1 %55, label %58, label %56, !dbg !1958

; <label>:56                                      ; preds = %53
  %57 = shl nsw i64 %54, 1, !dbg !1959
  tail call void @_ZN3pov22ResizeMediaMallocPoolsEl(i64 %57) #7, !dbg !1961
  %.pre61 = load i64* @_ZN3pov14MediaPoolIndexE, align 8, !dbg !1962, !tbaa !1862
  br label %58, !dbg !1964

; <label>:58                                      ; preds = %53, %56
  %59 = phi i64 [ %36, %53 ], [ %.pre61, %56 ]
  %60 = load i64** @_ZN3pov21MediaIntervalPoolSizeE, align 8, !dbg !1965, !tbaa !1870
  %61 = getelementptr inbounds i64* %60, i64 %59, !dbg !1965
  %62 = load i64* %61, align 8, !dbg !1965, !tbaa !1862
  %63 = icmp sgt i64 %thesize.0, %62, !dbg !1966
  %64 = load %"struct.pov::Media_Interval_Struct"*** @_ZN3pov17MediaIntervalPoolE, align 8, !dbg !1967, !tbaa !1870
  %65 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"** %64, i64 %59, !dbg !1967
  %66 = load %"struct.pov::Media_Interval_Struct"** %65, align 8, !dbg !1967, !tbaa !1870
  br i1 %63, label %67, label %80, !dbg !1968

; <label>:67                                      ; preds = %58
  %68 = bitcast %"struct.pov::Media_Interval_Struct"* %66 to i8*, !dbg !1969
  tail call void @_ZN3pov8pov_freeEPvPKci(i8* %68, i8* getelementptr inbounds ([66 x i8]* @.str, i64 0, i64 0), i32 216) #7, !dbg !1969
  %69 = load i64* @_ZN3pov14MediaPoolIndexE, align 8, !dbg !1969, !tbaa !1862
  %70 = load %"struct.pov::Media_Interval_Struct"*** @_ZN3pov17MediaIntervalPoolE, align 8, !dbg !1969, !tbaa !1870
  %71 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"** %70, i64 %69, !dbg !1969
  store %"struct.pov::Media_Interval_Struct"* null, %"struct.pov::Media_Interval_Struct"** %71, align 8, !dbg !1969, !tbaa !1870
  %72 = tail call i8* @_ZN3pov10pov_mallocEmPKciS1_(i64 %thesize.0, i8* getelementptr inbounds ([66 x i8]* @.str, i64 0, i64 0), i32 217, i8* getelementptr inbounds ([16 x i8]* @.str1, i64 0, i64 0)) #7, !dbg !1972
  %73 = bitcast i8* %72 to %"struct.pov::Media_Interval_Struct"*, !dbg !1973
  %74 = load i64* @_ZN3pov14MediaPoolIndexE, align 8, !dbg !1974, !tbaa !1862
  %75 = load %"struct.pov::Media_Interval_Struct"*** @_ZN3pov17MediaIntervalPoolE, align 8, !dbg !1975, !tbaa !1870
  %76 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"** %75, i64 %74, !dbg !1975
  %77 = bitcast %"struct.pov::Media_Interval_Struct"** %76 to i8**, !dbg !1976
  store i8* %72, i8** %77, align 8, !dbg !1976, !tbaa !1870
  tail call void @llvm.dbg.value(metadata %"struct.pov::Media_Interval_Struct"* %73, i64 0, metadata !1032, metadata !1851), !dbg !1977
  %78 = load i64** @_ZN3pov21MediaIntervalPoolSizeE, align 8, !dbg !1978, !tbaa !1870
  %79 = getelementptr inbounds i64* %78, i64 %74, !dbg !1978
  store i64 %thesize.0, i64* %79, align 8, !dbg !1979, !tbaa !1862
  br label %80

; <label>:80                                      ; preds = %58, %67
  %Media_Interval.0 = phi %"struct.pov::Media_Interval_Struct"* [ %73, %67 ], [ %66, %58 ]
  %81 = tail call fastcc i32 @_ZN3povL25set_up_sampling_intervalsEPNS_21Media_Interval_StructEiPNS_19Lit_Interval_StructEPNS_12Media_StructE(%"struct.pov::Media_Interval_Struct"* %Media_Interval.0, i32 1, %"struct.pov::Lit_Interval_Struct"* %39, %"struct.pov::Media_Struct"* %IMedia.1.lcssa) #7, !dbg !1980
  tail call void @llvm.dbg.value(metadata i32 %81, i64 0, metadata !1020, metadata !1851), !dbg !1892
  tail call void @llvm.dbg.value(metadata i32 %90, i64 0, metadata !1025, metadata !1981), !dbg !1856
  %82 = getelementptr inbounds float* %Colour, i64 1, !dbg !1982
  tail call void @llvm.dbg.value(metadata i32 %88, i64 0, metadata !1025, metadata !1983), !dbg !1856
  %83 = getelementptr inbounds float* %Colour, i64 2, !dbg !1984
  tail call void @llvm.dbg.value(metadata i32 %86, i64 0, metadata !1025, metadata !1985), !dbg !1856
  tail call void @llvm.dbg.value(metadata i32 0, i64 0, metadata !1018, metadata !1851), !dbg !1986
  %84 = icmp sgt i32 %81, 0, !dbg !1987
  br i1 %84, label %.lr.ph25, label %._crit_edge, !dbg !1990

.lr.ph25:                                         ; preds = %80
  %85 = bitcast float* %83 to i32*, !dbg !1984
  %86 = load i32* %85, align 4, !dbg !1984, !tbaa !1991
  %87 = bitcast float* %82 to i32*, !dbg !1982
  %88 = load i32* %87, align 4, !dbg !1982, !tbaa !1991
  %89 = bitcast float* %Colour to i32*, !dbg !1993
  %90 = load i32* %89, align 4, !dbg !1993, !tbaa !1991
  %91 = getelementptr inbounds [5 x float]* %C0, i64 0, i64 0, !dbg !1994
  %92 = getelementptr inbounds [5 x float]* %od0, i64 0, i64 0, !dbg !1999
  %93 = icmp eq i32 %use_scattering.1.lcssa, 0, !dbg !2000
  %94 = icmp ne i32 %ignore_photons.1.lcssa, 0, !dbg !2002
  %or.cond = or i1 %93, %94, !dbg !2003
  %95 = getelementptr inbounds [5 x float]* %PhotonColour, i64 0, i64 0, !dbg !2004
  %96 = getelementptr inbounds [5 x float]* %PhotonColour, i64 0, i64 1, !dbg !2008
  %97 = getelementptr inbounds [5 x float]* %PhotonColour, i64 0, i64 2, !dbg !2011
  %98 = getelementptr inbounds [3 x double]* %TempPoint, i64 0, i64 0, !dbg !2012
  %99 = getelementptr inbounds %"struct.pov::Ray_Struct"* %Ray, i64 0, i32 0, i64 0, !dbg !2013
  %100 = getelementptr inbounds %"struct.pov::Ray_Struct"* %Ray, i64 0, i32 1, i64 0, !dbg !2014
  %101 = getelementptr inbounds %"struct.pov::Ray_Struct"* %Ray, i64 0, i32 0, i64 2, !dbg !2015
  %102 = getelementptr inbounds %"struct.pov::Ray_Struct"* %Ray, i64 0, i32 1, i64 2, !dbg !2017
  %103 = getelementptr inbounds [3 x double]* %TempPoint, i64 0, i64 2, !dbg !2018
  %104 = add i32 %81, -1, !dbg !1990
  br label %106, !dbg !1990

.preheader:                                       ; preds = %._crit_edge19
  br i1 %84, label %.lr.ph, label %._crit_edge, !dbg !2019

.lr.ph:                                           ; preds = %.preheader
  %105 = add i32 %81, -1, !dbg !2019
  br label %255, !dbg !2019

; <label>:106                                     ; preds = %._crit_edge19, %.lr.ph25
  %indvars.iv = phi i64 [ 0, %.lr.ph25 ], [ %indvars.iv.next, %._crit_edge19 ]
  %107 = phi i32 [ %90, %.lr.ph25 ], [ %.lcssa11, %._crit_edge19 ]
  %108 = phi i32 [ %88, %.lr.ph25 ], [ %.lcssa10, %._crit_edge19 ]
  %109 = phi i32 [ %86, %.lr.ph25 ], [ %.lcssa9, %._crit_edge19 ]
  %110 = load %"struct.pov::Light_Source_Struct"** getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 27), align 8, !dbg !2021, !tbaa !2023
  %111 = getelementptr inbounds %"struct.pov::Light_Source_Struct"* %110, i64 0, i32 33, !dbg !2027
  %112 = load i8* %111, align 1, !dbg !2027, !tbaa !2028
  %113 = icmp eq i8 %112, 0, !dbg !2031
  %114 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Media_Interval.0, i64 %indvars.iv, !dbg !2032
  %115 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Media_Interval.0, i64 %indvars.iv, i32 4, !dbg !2034
  %116 = load double* %115, align 8, !dbg !2034, !tbaa !2035
  %117 = load double* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 16), align 8, !dbg !2037, !tbaa !2038
  br i1 %113, label %118, label %123, !dbg !2039

; <label>:118                                     ; preds = %106
  %119 = load double* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 17), align 8, !dbg !2040, !tbaa !2042
  %120 = fmul double %117, %119, !dbg !2043
  %121 = load double* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 30), align 8, !dbg !2044, !tbaa !2045
  %122 = fmul double %120, %121, !dbg !2046
  br label %126, !dbg !2047

; <label>:123                                     ; preds = %106
  %124 = load double* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 30), align 8, !dbg !2048, !tbaa !2045
  %125 = fmul double %117, %124, !dbg !2049
  br label %126

; <label>:126                                     ; preds = %123, %118
  %127 = phi double [ %124, %123 ], [ %121, %118 ]
  %.pn = phi double [ %125, %123 ], [ %122, %118 ]
  %minSamples.0.in = fdiv double %116, %.pn, !dbg !2050
  %minSamples.0 = fptosi double %minSamples.0.in to i32, !dbg !2051
  %128 = load i32* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 31), align 8, !dbg !2052, !tbaa !2054
  %129 = icmp sgt i32 %minSamples.0, %128, !dbg !2055
  br i1 %129, label %130, label %141, !dbg !2056

; <label>:130                                     ; preds = %126
  call void @llvm.dbg.value(metadata i32 %128, i64 0, metadata !1034, metadata !1851), !dbg !2057
  br i1 %113, label %131, label %137, !dbg !2058

; <label>:131                                     ; preds = %130
  %132 = load double* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 17), align 8, !dbg !2060, !tbaa !2042
  %133 = fmul double %117, %132, !dbg !2063
  %134 = sitofp i32 %128 to double, !dbg !2064
  %135 = fmul double %134, %133, !dbg !2065
  %136 = fdiv double %116, %135, !dbg !2066
  call void @llvm.dbg.value(metadata double %136, i64 0, metadata !1040, metadata !1851), !dbg !2067
  br label %141, !dbg !2068

; <label>:137                                     ; preds = %130
  %138 = sitofp i32 %128 to double, !dbg !2069
  %139 = fmul double %138, %117, !dbg !2071
  %140 = fdiv double %116, %139, !dbg !2072
  call void @llvm.dbg.value(metadata double %140, i64 0, metadata !1040, metadata !1851), !dbg !2067
  br label %141

; <label>:141                                     ; preds = %126, %131, %137
  %minSamples.1 = phi i32 [ %128, %137 ], [ %128, %131 ], [ %minSamples.0, %126 ]
  %mediaSpacingFactor.0 = phi double [ %140, %137 ], [ %136, %131 ], [ %127, %126 ]
  tail call void @llvm.dbg.value(metadata i64* getelementptr inbounds ([126 x i64]* @_ZN3pov5statsE, i64 0, i64 100), i64 0, metadata !1133, metadata !1851), !dbg !2073
  %142 = load i64* getelementptr inbounds ([126 x i64]* @_ZN3pov5statsE, i64 0, i64 100), align 8, !dbg !2075, !tbaa !1862
  %143 = add nsw i64 %142, 1, !dbg !2075
  store i64 %143, i64* getelementptr inbounds ([126 x i64]* @_ZN3pov5statsE, i64 0, i64 100), align 8, !dbg !2075, !tbaa !1862
  call void @llvm.dbg.value(metadata i32 0, i64 0, metadata !1019, metadata !1851), !dbg !2076
  %144 = icmp sgt i32 %minSamples.1, 0, !dbg !2077
  br i1 %144, label %.lr.ph18, label %._crit_edge19, !dbg !2078

.lr.ph18:                                         ; preds = %141
  %145 = sitofp i32 %minSamples.1 to double, !dbg !2079
  %146 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Media_Interval.0, i64 %indvars.iv, i32 2, !dbg !2080
  %147 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Media_Interval.0, i64 %indvars.iv, i32 5, i64 0, !dbg !2081
  %148 = shl nsw i32 %minSamples.1, 1, !dbg !2082
  %149 = sitofp i32 %148 to float, !dbg !2083
  %150 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Media_Interval.0, i64 %indvars.iv, i32 5, i64 1, !dbg !2084
  %151 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %Media_Interval.0, i64 %indvars.iv, i32 5, i64 2, !dbg !2085
  %152 = add i32 %minSamples.1, -1, !dbg !2078
  br label %153, !dbg !2078

; <label>:153                                     ; preds = %250, %.lr.ph18
  %j.016 = phi i32 [ 0, %.lr.ph18 ], [ %254, %250 ]
  %154 = phi i32 [ %107, %.lr.ph18 ], [ %253, %250 ]
  %155 = phi i32 [ %108, %.lr.ph18 ], [ %252, %250 ]
  %156 = phi i32 [ %109, %.lr.ph18 ], [ %251, %250 ]
  %157 = sitofp i32 %j.016 to double, !dbg !2086
  %158 = fadd double %157, 5.000000e-01, !dbg !2087
  %159 = call i32 @_ZN3pov8POV_RANDEv() #7, !dbg !2088
  %160 = sitofp i32 %159 to double, !dbg !2088
  %161 = fmul double %160, 0x3F0000200040021E, !dbg !2088
  %162 = load double* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 7), align 8, !dbg !2089, !tbaa !2090
  %163 = fmul double %162, %161, !dbg !2091
  %164 = fadd double %158, %163, !dbg !2092
  %165 = fmul double %162, 5.000000e-01, !dbg !2093
  %166 = fsub double %164, %165, !dbg !2094
  %167 = fdiv double %166, %145, !dbg !2095
  call void @llvm.dbg.value(metadata double %167, i64 0, metadata !1035, metadata !1851), !dbg !2096
  call fastcc void @_ZN3povL12sample_mediaEPNS_17Light_List_StructEiPNS_10Ray_StructEPPNS_12Media_StructEPNS_21Media_Interval_StructEidPfS9_iS1_i(%"struct.pov::Light_List_Struct"* null, i32 0, %"struct.pov::Ray_Struct"* %Ray, %"struct.pov::Media_Struct"** %Media_List, %"struct.pov::Media_Interval_Struct"* %114, i32 1, double %167, float* %91, float* %92, i32 2, %"struct.pov::Light_List_Struct"* null, i32 0) #7, !dbg !2097
  br i1 %or.cond, label %250, label %168, !dbg !2003

; <label>:168                                     ; preds = %153
  %169 = load %"struct.pov::Light_Source_Struct"** getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 27), align 8, !dbg !2098, !tbaa !2023
  %170 = getelementptr inbounds %"struct.pov::Light_Source_Struct"* %169, i64 0, i32 33, !dbg !2099
  %171 = load i8* %170, align 1, !dbg !2099, !tbaa !2028
  %172 = icmp eq i8 %171, 0, !dbg !2100
  %173 = load double* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 16), align 8, !dbg !2101, !tbaa !2038
  %174 = fmul double %mediaSpacingFactor.0, %173, !dbg !2102
  br i1 %172, label %175, label %190, !dbg !2103

; <label>:175                                     ; preds = %168
  %176 = load double* getelementptr inbounds (%"struct.pov::photon_options_struct"* @_ZN3pov13photonOptionsE, i64 0, i32 17), align 8, !dbg !2104, !tbaa !2042
  %177 = load double* %115, align 8, !dbg !2105, !tbaa !2035
  %178 = fmul double %167, %177, !dbg !2106
  %179 = fadd double %176, %178, !dbg !2107
  %180 = load double* %146, align 8, !dbg !2080, !tbaa !2108
  %181 = fadd double %180, %179, !dbg !2109
  %182 = fmul double %174, %181, !dbg !2110
  %183 = fptrunc double %182 to float, !dbg !2111
  tail call void @llvm.dbg.value(metadata float* %95, i64 0, metadata !1141, metadata !1851), !dbg !2112
  tail call void @llvm.dbg.value(metadata float* undef, i64 0, metadata !1142, metadata !1851), !dbg !2113
  tail call void @llvm.dbg.value(metadata float %183, i64 0, metadata !1143, metadata !1851), !dbg !2114
  %184 = bitcast i32 %154 to float, !dbg !2115
  %185 = fmul float %184, %183, !dbg !2116
  store float %185, float* %95, align 16, !dbg !2117, !tbaa !1991
  %186 = bitcast i32 %155 to float, !dbg !2118
  %187 = fmul float %186, %183, !dbg !2119
  store float %187, float* %96, align 4, !dbg !2120, !tbaa !1991
  %188 = bitcast i32 %156 to float, !dbg !2121
  %189 = fmul float %188, %183, !dbg !2122
  store float %189, float* %97, align 8, !dbg !2123, !tbaa !1991
  br label %198, !dbg !2124

; <label>:190                                     ; preds = %168
  %191 = fptrunc double %174 to float, !dbg !2125
  tail call void @llvm.dbg.value(metadata float* %95, i64 0, metadata !1141, metadata !1851), !dbg !2126
  tail call void @llvm.dbg.value(metadata float* undef, i64 0, metadata !1142, metadata !1851), !dbg !2128
  tail call void @llvm.dbg.value(metadata float %191, i64 0, metadata !1143, metadata !1851), !dbg !2129
  %192 = bitcast i32 %154 to float, !dbg !2130
  %193 = fmul float %192, %191, !dbg !2131
  store float %193, float* %95, align 16, !dbg !2132, !tbaa !1991
  %194 = bitcast i32 %155 to float, !dbg !2133
  %195 = fmul float %194, %191, !dbg !2134
  store float %195, float* %96, align 4, !dbg !2135, !tbaa !1991
  %196 = bitcast i32 %156 to float, !dbg !2136
  %197 = fmul float %196, %191, !dbg !2137
  store float %197, float* %97, align 8, !dbg !2138, !tbaa !1991
  %.pre62 = load double* %115, align 8, !dbg !2139, !tbaa !2035
  %.pre63 = load double* %146, align 8, !dbg !2140, !tbaa !2108
  br label %198

; <label>:198                                     ; preds = %190, %175
  %199 = phi double [ %.pre63, %190 ], [ %180, %175 ]
  %200 = phi double [ %.pre62, %190 ], [ %177, %175 ]
  %201 = load float* %Colour, align 4, !dbg !2141, !tbaa !1991
  %202 = fpext float %201 to double, !dbg !2141
  %203 = load float* %147, align 4, !dbg !2081, !tbaa !1991
  %204 = fsub float -0.000000e+00, %203, !dbg !2142
  %205 = fdiv float %204, %149, !dbg !2143
  %206 = fpext float %205 to double, !dbg !2142
  %207 = call double @exp(double %206) #8, !dbg !2144
  %208 = fmul double %202, %207, !dbg !2145
  %209 = fptrunc double %208 to float, !dbg !2141
  %210 = bitcast float %209 to i32, !dbg !2146
  call void @llvm.dbg.value(metadata i32 %210, i64 0, metadata !1025, metadata !1981), !dbg !1856
  %211 = load float* %82, align 4, !dbg !2147, !tbaa !1991
  %212 = fpext float %211 to double, !dbg !2147
  %213 = load float* %150, align 4, !dbg !2084, !tbaa !1991
  %214 = fsub float -0.000000e+00, %213, !dbg !2148
  %215 = fdiv float %214, %149, !dbg !2149
  %216 = fpext float %215 to double, !dbg !2148
  %217 = call double @exp(double %216) #8, !dbg !2150
  %218 = fmul double %212, %217, !dbg !2151
  %219 = fptrunc double %218 to float, !dbg !2147
  %220 = bitcast float %219 to i32, !dbg !2152
  call void @llvm.dbg.value(metadata i32 %220, i64 0, metadata !1025, metadata !1983), !dbg !1856
  %221 = load float* %83, align 4, !dbg !2153, !tbaa !1991
  %222 = fpext float %221 to double, !dbg !2153
  %223 = load float* %151, align 4, !dbg !2085, !tbaa !1991
  %224 = fsub float -0.000000e+00, %223, !dbg !2154
  %225 = fdiv float %224, %149, !dbg !2155
  %226 = fpext float %225 to double, !dbg !2154
  %227 = call double @exp(double %226) #8, !dbg !2156
  %228 = fmul double %222, %227, !dbg !2157
  %229 = fptrunc double %228 to float, !dbg !2153
  %230 = bitcast float %229 to i32, !dbg !2158
  call void @llvm.dbg.value(metadata i32 %230, i64 0, metadata !1025, metadata !1985), !dbg !1856
  %231 = fmul double %167, %200, !dbg !2159
  %232 = fadd double %231, %199, !dbg !2160
  tail call void @llvm.dbg.value(metadata double* %98, i64 0, metadata !1149, metadata !1851), !dbg !2161
  tail call void @llvm.dbg.value(metadata double* %99, i64 0, metadata !1150, metadata !1851), !dbg !2162
  tail call void @llvm.dbg.value(metadata double %232, i64 0, metadata !1151, metadata !1851), !dbg !2163
  tail call void @llvm.dbg.value(metadata double* %100, i64 0, metadata !1152, metadata !1851), !dbg !2164
  %233 = bitcast %"struct.pov::Ray_Struct"* %Ray to <2 x double>*, !dbg !2165
  %234 = load <2 x double>* %233, align 8, !dbg !2165, !tbaa !2166
  %235 = bitcast double* %100 to <2 x double>*, !dbg !2167
  %236 = load <2 x double>* %235, align 8, !dbg !2167, !tbaa !2166
  %237 = insertelement <2 x double> undef, double %232, i32 0, !dbg !2168
  %238 = insertelement <2 x double> %237, double %232, i32 1, !dbg !2168
  %239 = fmul <2 x double> %238, %236, !dbg !2168
  %240 = fadd <2 x double> %234, %239, !dbg !2169
  %241 = bitcast [3 x double]* %TempPoint to <2 x double>*, !dbg !2170
  store <2 x double> %240, <2 x double>* %241, align 16, !dbg !2170, !tbaa !2166
  %242 = load double* %101, align 8, !dbg !2015, !tbaa !2166
  %243 = load double* %102, align 8, !dbg !2017, !tbaa !2166
  %244 = fmul double %232, %243, !dbg !2171
  %245 = fadd double %242, %244, !dbg !2172
  store double %245, double* %103, align 16, !dbg !2173, !tbaa !2166
  %246 = load double* %115, align 8, !dbg !2174, !tbaa !2035
  %247 = fmul double %167, %246, !dbg !2175
  %248 = load double* %146, align 8, !dbg !2176, !tbaa !2108
  %249 = fadd double %247, %248, !dbg !2177
  call void @_ZN3pov14addMediaPhotonEPdS0_Pfd(double* %98, double* %99, float* %95, double %249) #7, !dbg !2178
  br label %250, !dbg !2179

; <label>:250                                     ; preds = %198, %153
  %251 = phi i32 [ %230, %198 ], [ %156, %153 ]
  %252 = phi i32 [ %220, %198 ], [ %155, %153 ]
  %253 = phi i32 [ %210, %198 ], [ %154, %153 ]
  %254 = add nuw nsw i32 %j.016, 1, !dbg !2180
  call void @llvm.dbg.value(metadata i32 %254, i64 0, metadata !1019, metadata !1851), !dbg !2076
  %exitcond59 = icmp eq i32 %j.016, %152, !dbg !2078
  br i1 %exitcond59, label %._crit_edge19, label %153, !dbg !2078

._crit_edge19:                                    ; preds = %250, %141
  %.lcssa11 = phi i32 [ %107, %141 ], [ %253, %250 ]
  %.lcssa10 = phi i32 [ %108, %141 ], [ %252, %250 ]
  %.lcssa9 = phi i32 [ %109, %141 ], [ %251, %250 ]
  %indvars.iv.next = add nuw nsw i64 %indvars.iv, 1, !dbg !1990
  %lftr.wideiv = trunc i64 %indvars.iv to i32, !dbg !1990
  %exitcond60 = icmp eq i32 %lftr.wideiv, %104, !dbg !1990
  br i1 %exitcond60, label %.preheader, label %106, !dbg !1990

; <label>:255                                     ; preds = %255, %.lr.ph
  %i.113 = phi i32 [ 0, %.lr.ph ], [ %284, %255 ]
  %curr.012 = phi %"struct.pov::Media_Interval_Struct"* [ %Media_Interval.0, %.lr.ph ], [ %283, %255 ]
  %256 = phi float [ 0.000000e+00, %.lr.ph ], [ %268, %255 ]
  %257 = phi float [ 0.000000e+00, %.lr.ph ], [ %275, %255 ]
  %258 = phi float [ 0.000000e+00, %.lr.ph ], [ %282, %255 ]
  %259 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %curr.012, i64 0, i32 5, i64 0, !dbg !2181
  %260 = load float* %259, align 4, !dbg !2181, !tbaa !1991
  %261 = fpext float %260 to double, !dbg !2181
  %262 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %curr.012, i64 0, i32 1, !dbg !2184
  %263 = load i32* %262, align 4, !dbg !2184, !tbaa !2185
  %264 = sitofp i32 %263 to double, !dbg !2186
  %265 = fdiv double %261, %264, !dbg !2187
  %266 = fpext float %256 to double, !dbg !2188
  %267 = fadd double %266, %265, !dbg !2188
  %268 = fptrunc double %267 to float, !dbg !2188
  %269 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %curr.012, i64 0, i32 5, i64 1, !dbg !2189
  %270 = load float* %269, align 4, !dbg !2189, !tbaa !1991
  %271 = fpext float %270 to double, !dbg !2189
  %272 = fdiv double %271, %264, !dbg !2190
  %273 = fpext float %257 to double, !dbg !2191
  %274 = fadd double %273, %272, !dbg !2191
  %275 = fptrunc double %274 to float, !dbg !2191
  %276 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %curr.012, i64 0, i32 5, i64 2, !dbg !2192
  %277 = load float* %276, align 4, !dbg !2192, !tbaa !1991
  %278 = fpext float %277 to double, !dbg !2192
  %279 = fdiv double %278, %264, !dbg !2193
  %280 = fpext float %258 to double, !dbg !2194
  %281 = fadd double %280, %279, !dbg !2194
  %282 = fptrunc double %281 to float, !dbg !2194
  %283 = getelementptr inbounds %"struct.pov::Media_Interval_Struct"* %curr.012, i64 1, !dbg !2195
  call void @llvm.dbg.value(metadata %"struct.pov::Media_Interval_Struct"* %283, i64 0, metadata !1033, metadata !1851), !dbg !2196
  %284 = add nuw nsw i32 %i.113, 1, !dbg !2197
  call void @llvm.dbg.value(metadata i32 %284, i64 0, metadata !1018, metadata !1851), !dbg !1986
  %exitcond = icmp eq i32 %i.113, %105, !dbg !2019
  br i1 %exitcond, label %._crit_edge, label %255, !dbg !2019

._crit_edge:                                      ; preds = %255, %80, %.preheader
  %.lcssa8 = phi float [ 0.000000e+00, %.preheader ], [ 0.000000e+00, %80 ], [ %268, %255 ]
  %.lcssa7 = phi float [ 0.000000e+00, %.preheader ], [ 0.000000e+00, %80 ], [ %275, %255 ]
  %.lcssa = phi float [ 0.000000e+00, %.preheader ], [ 0.000000e+00, %80 ], [ %282, %255 ]
  %285 = load float* %Colour, align 4, !dbg !2198, !tbaa !1991
  %286 = fpext float %285 to double, !dbg !2198
  %287 = fsub float -0.000000e+00, %.lcssa8, !dbg !2199
  %288 = fpext float %287 to double, !dbg !2199
  %289 = call double @exp(double %288) #8, !dbg !2200
  %290 = fmul double %286, %289, !dbg !2201
  %291 = fptrunc double %290 to float, !dbg !2198
  store float %291, float* %Colour, align 4, !dbg !2202, !tbaa !1991
  %292 = load float* %82, align 4, !dbg !2203, !tbaa !1991
  %293 = fpext float %292 to double, !dbg !2203
  %294 = fsub float -0.000000e+00, %.lcssa7, !dbg !2204
  %295 = fpext float %294 to double, !dbg !2204
  %296 = call double @exp(double %295) #8, !dbg !2205
  %297 = fmul double %293, %296, !dbg !2206
  %298 = fptrunc double %297 to float, !dbg !2203
  store float %298, float* %82, align 4, !dbg !2207, !tbaa !1991
  %299 = load float* %83, align 4, !dbg !2208, !tbaa !1991
  %300 = fpext float %299 to double, !dbg !2208
  %301 = fsub float -0.000000e+00, %.lcssa, !dbg !2209
  %302 = fpext float %301 to double, !dbg !2209
  %303 = call double @exp(double %302) #8, !dbg !2210
  %304 = fmul double %300, %303, !dbg !2211
  %305 = fptrunc double %304 to float, !dbg !2208
  store float %305, float* %83, align 4, !dbg !2212, !tbaa !1991
  %306 = load i64* @_ZN3pov14MediaPoolIndexE, align 8, !dbg !2213, !tbaa !1862
  %307 = add nsw i64 %306, -1, !dbg !2213
  store i64 %307, i64* @_ZN3pov14MediaPoolIndexE, align 8, !dbg !2213, !tbaa !1862
  br label %308, !dbg !2214

; <label>:308                                     ; preds = %._crit_edge, %29, %7
  ret void, !dbg !2214
}
