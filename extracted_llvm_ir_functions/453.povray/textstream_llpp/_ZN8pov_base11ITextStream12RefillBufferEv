define void @_ZN8pov_base11ITextStream12RefillBufferEv(%"class.pov_base::ITextStream"* %this) #0 align 2 {
entry:
  tail call void @llvm.dbg.value(metadata !{%"class.pov_base::ITextStream"* %this}, i64 0, metadata !386), !dbg !608
  %bufferoffset = getelementptr inbounds %"class.pov_base::ITextStream"* %this, i64 0, i32 3, !dbg !609
  %0 = load i64* %bufferoffset, align 8, !dbg !609, !tbaa !601
  %maxbufferoffset = getelementptr inbounds %"class.pov_base::ITextStream"* %this, i64 0, i32 4, !dbg !609
  %1 = load i64* %maxbufferoffset, align 8, !dbg !609, !tbaa !601
  %cmp = icmp ult i64 %0, %1, !dbg !609
  %curpos = getelementptr inbounds %"class.pov_base::ITextStream"* %this, i64 0, i32 6, !dbg !610
  br i1 %cmp, label %if.then, label %entry.if.end_crit_edge, !dbg !609

entry.if.end_crit_edge:                           ; preds = %entry
  %stream12.pre = getelementptr inbounds %"class.pov_base::ITextStream"* %this, i64 0, i32 1, !dbg !612
  br label %if.end, !dbg !609

if.then:                                          ; preds = %entry
  %2 = load i64* %curpos, align 8, !dbg !610, !tbaa !601
  %sub24 = sub i64 %0, %1, !dbg !610
  %sub4 = add i64 %2, %sub24, !dbg !610
  store i64 %sub4, i64* %curpos, align 8, !dbg !610, !tbaa !601
  %stream = getelementptr inbounds %"class.pov_base::ITextStream"* %this, i64 0, i32 1, !dbg !613
  %3 = load %"class.pov_base::IStream"** %stream, align 8, !dbg !613, !tbaa !590
  %4 = getelementptr inbounds %"class.pov_base::IStream"* %3, i64 0, i32 0, !dbg !613
  %call = tail call %"class.pov_base::IOBase"* @_ZN8pov_base6IOBase5seekgEmj(%"class.pov_base::IOBase"* %4, i64 %sub4, i32 0) #9, !dbg !613
  br label %if.end, !dbg !614

if.end:                                           ; preds = %entry.if.end_crit_edge, %if.then
  %stream12.pre-phi = phi %"class.pov_base::IStream"** [ %stream12.pre, %entry.if.end_crit_edge ], [ %stream, %if.then ], !dbg !612
  tail call void @llvm.dbg.value(metadata !615, i64 0, metadata !616), !dbg !618
  %filelength = getelementptr inbounds %"class.pov_base::ITextStream"* %this, i64 0, i32 5, !dbg !617
  %5 = load i64* %filelength, align 8, !dbg !617, !tbaa !601
  %6 = load i64* %curpos, align 8, !dbg !617, !tbaa !601
  %sub7 = sub i64 %5, %6, !dbg !617
  tail call void @llvm.dbg.value(metadata !{i64 %sub7}, i64 0, metadata !619), !dbg !618
  %cmp.i = icmp ult i64 %sub7, 512, !dbg !620
  %.sroa.speculated = select i1 %cmp.i, i64 %sub7, i64 512, !dbg !617
  store i64 %.sroa.speculated, i64* %maxbufferoffset, align 8, !dbg !617, !tbaa !601
  store i64 0, i64* %bufferoffset, align 8, !dbg !622, !tbaa !601
  %7 = load %"class.pov_base::IStream"** %stream12.pre-phi, align 8, !dbg !612, !tbaa !590
  %8 = getelementptr inbounds %"class.pov_base::IStream"* %7, i64 0, i32 0, !dbg !612
  %arraydecay = getelementptr inbounds %"class.pov_base::ITextStream"* %this, i64 0, i32 2, i64 0, !dbg !612
  %call14 = tail call %"class.pov_base::IOBase"* @_ZN8pov_base6IOBase4readEPvm(%"class.pov_base::IOBase"* %8, i8* %arraydecay, i64 %.sroa.speculated) #9, !dbg !612
  %9 = load %"class.pov_base::IStream"** %stream12.pre-phi, align 8, !dbg !623, !tbaa !590
  %fail.i = getelementptr inbounds %"class.pov_base::IStream"* %9, i64 0, i32 0, i32 1, !dbg !624
  %10 = load i8* %fail.i, align 1, !dbg !624, !tbaa !625, !range !626
  %tobool.i = icmp ne i8 %10, 0, !dbg !624
  %tobool = icmp eq %"class.pov_base::IStream"* %9, null, !dbg !623
  %or.cond = or i1 %tobool.i, %tobool, !dbg !624
  br i1 %or.cond, label %if.else, label %if.then17, !dbg !624

if.then17:                                        ; preds = %if.end
  %11 = load i64* %maxbufferoffset, align 8, !dbg !627, !tbaa !601
  %12 = load i64* %curpos, align 8, !dbg !627, !tbaa !601
  %add = add i64 %12, %11, !dbg !627
  br label %if.end23, !dbg !627

if.else:                                          ; preds = %if.end
  %f.i = getelementptr inbounds %"class.pov_base::IStream"* %9, i64 0, i32 0, i32 2, !dbg !628
  %13 = load %struct._IO_FILE** %f.i, align 8, !dbg !628, !tbaa !590
  %cmp.i25 = icmp eq %struct._IO_FILE* %13, null, !dbg !628
  br i1 %cmp.i25, label %if.end23, label %cond.false.i, !dbg !628

cond.false.i:                                     ; preds = %if.else
  %call.i = tail call i64 @ftell(%struct._IO_FILE* %13) #11, !dbg !628
  br label %if.end23, !dbg !628

if.end23:                                         ; preds = %cond.false.i, %if.else, %if.then17
  %storemerge = phi i64 [ %add, %if.then17 ], [ %call.i, %cond.false.i ], [ -1, %if.else ]
  store i64 %storemerge, i64* %curpos, align 8, !dbg !627, !tbaa !601
  ret void, !dbg !630
}
