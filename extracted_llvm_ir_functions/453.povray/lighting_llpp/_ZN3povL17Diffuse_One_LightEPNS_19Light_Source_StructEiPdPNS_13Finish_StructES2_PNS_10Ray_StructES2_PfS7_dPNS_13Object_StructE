define internal fastcc void @_ZN3povL17Diffuse_One_LightEPNS_19Light_Source_StructEiPdPNS_13Finish_StructES2_PNS_10Ray_StructES2_PfS7_dPNS_13Object_StructE(%"struct.pov::Light_Source_Struct"* %Light_Source, i32 %Light_Index, double* nocapture %REye, %"struct.pov::Finish_Struct"* nocapture %Finish, double* %IPoint, %"struct.pov::Ray_Struct"* %Eye, double* nocapture %Layer_Normal, float* nocapture %Layer_Pigment_Colour, float* nocapture %Colour, double %Attenuation, %"struct.pov::Object_Struct"* nocapture %Object) #0 {
entry:
  %Light_Source_Depth = alloca double, align 8
  %Light_Source_Ray = alloca %"struct.pov::Ray_Struct", align 8
  %Light_Colour = alloca [5 x float], align 16
  call void @llvm.dbg.value(metadata !{%"struct.pov::Light_Source_Struct"* %Light_Source}, i64 0, metadata !1706), !dbg !6403
  call void @llvm.dbg.value(metadata !{i32 %Light_Index}, i64 0, metadata !1707), !dbg !6403
  call void @llvm.dbg.value(metadata !{double* %REye}, i64 0, metadata !1708), !dbg !6403
  call void @llvm.dbg.value(metadata !{%"struct.pov::Finish_Struct"* %Finish}, i64 0, metadata !1709), !dbg !6403
  call void @llvm.dbg.value(metadata !{double* %IPoint}, i64 0, metadata !1710), !dbg !6403
  call void @llvm.dbg.value(metadata !{%"struct.pov::Ray_Struct"* %Eye}, i64 0, metadata !1711), !dbg !6403
  call void @llvm.dbg.value(metadata !{double* %Layer_Normal}, i64 0, metadata !1712), !dbg !6403
  call void @llvm.dbg.value(metadata !{float* %Layer_Pigment_Colour}, i64 0, metadata !1713), !dbg !6403
  call void @llvm.dbg.value(metadata !{float* %Colour}, i64 0, metadata !1714), !dbg !6403
  call void @llvm.dbg.value(metadata !{double %Attenuation}, i64 0, metadata !1715), !dbg !6403
  call void @llvm.dbg.value(metadata !{%"struct.pov::Object_Struct"* %Object}, i64 0, metadata !1716), !dbg !6403
  call void @llvm.dbg.declare(metadata !{double* %Light_Source_Depth}, metadata !1717), !dbg !6404
  %0 = bitcast %"struct.pov::Ray_Struct"* %Light_Source_Ray to i8*, !dbg !6405
  call void @llvm.lifetime.start(i64 856, i8* %0) #6, !dbg !6405
  call void @llvm.dbg.declare(metadata !{%"struct.pov::Ray_Struct"* %Light_Source_Ray}, metadata !1719), !dbg !6405
  call void @llvm.dbg.declare(metadata !{[5 x float]* %Light_Colour}, metadata !1720), !dbg !6406
  %arraydecay = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 0, !dbg !6407
  call fastcc void @_ZN3povL8do_lightEPNS_19Light_Source_StructEPdPNS_10Ray_StructES4_S2_Pf(%"struct.pov::Light_Source_Struct"* %Light_Source, double* %Light_Source_Depth, %"struct.pov::Ray_Struct"* %Light_Source_Ray, %"struct.pov::Ray_Struct"* %Eye, double* %IPoint, float* %arraydecay) #7, !dbg !6407
  %1 = load float* %arraydecay, align 16, !dbg !6408, !tbaa !2644
  %fabsf = call float @fabsf(float %1) #4, !dbg !6408
  %2 = fpext float %fabsf to double, !dbg !6408
  %cmp = fcmp olt double %2, 1.000000e-07, !dbg !6408
  br i1 %cmp, label %land.lhs.true, label %if.end, !dbg !6408

land.lhs.true:                                    ; preds = %entry
  %arrayidx1 = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 1, !dbg !6409
  %3 = load float* %arrayidx1, align 4, !dbg !6409, !tbaa !2644
  %fabsf132 = call float @fabsf(float %3) #4, !dbg !6409
  %4 = fpext float %fabsf132 to double, !dbg !6409
  %cmp4 = fcmp olt double %4, 1.000000e-07, !dbg !6409
  br i1 %cmp4, label %land.lhs.true5, label %if.end, !dbg !6409

land.lhs.true5:                                   ; preds = %land.lhs.true
  %arrayidx6 = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 2, !dbg !6410
  %5 = load float* %arrayidx6, align 8, !dbg !6410, !tbaa !2644
  %fabsf133 = call float @fabsf(float %5) #4, !dbg !6410
  %6 = fpext float %fabsf133 to double, !dbg !6410
  %cmp9 = fcmp olt double %6, 1.000000e-07, !dbg !6410
  br i1 %cmp9, label %cleanup, label %if.end, !dbg !6410

if.end:                                           ; preds = %land.lhs.true5, %land.lhs.true, %entry
  %Flags = getelementptr inbounds %"struct.pov::Object_Struct"* %Object, i64 0, i32 13, !dbg !6411
  %7 = load i32* %Flags, align 4, !dbg !6411, !tbaa !2301
  %and = and i32 %7, 16384, !dbg !6411
  %tobool = icmp eq i32 %and, 0, !dbg !6411
  br i1 %tobool, label %if.then11, label %if.end16, !dbg !6411

if.then11:                                        ; preds = %if.end
  %arraydecay12 = getelementptr inbounds %"struct.pov::Ray_Struct"* %Light_Source_Ray, i64 0, i32 1, i64 0, !dbg !6412
  tail call void @llvm.dbg.value(metadata !{double* %Layer_Normal}, i64 0, metadata !6414), !dbg !6415
  tail call void @llvm.dbg.value(metadata !{double* %arraydecay12}, i64 0, metadata !6416), !dbg !6415
  %8 = load double* %Layer_Normal, align 8, !dbg !6417, !tbaa !2552
  %9 = load double* %arraydecay12, align 8, !dbg !6417, !tbaa !2552
  %mul.i = fmul double %8, %9, !dbg !6417
  %arrayidx2.i = getelementptr inbounds double* %Layer_Normal, i64 1, !dbg !6417
  %10 = load double* %arrayidx2.i, align 8, !dbg !6417, !tbaa !2552
  %arrayidx3.i = getelementptr inbounds %"struct.pov::Ray_Struct"* %Light_Source_Ray, i64 0, i32 1, i64 1, !dbg !6417
  %11 = load double* %arrayidx3.i, align 8, !dbg !6417, !tbaa !2552
  %mul4.i = fmul double %10, %11, !dbg !6417
  %add.i = fadd double %mul.i, %mul4.i, !dbg !6417
  %arrayidx5.i = getelementptr inbounds double* %Layer_Normal, i64 2, !dbg !6417
  %12 = load double* %arrayidx5.i, align 8, !dbg !6417, !tbaa !2552
  %arrayidx6.i = getelementptr inbounds %"struct.pov::Ray_Struct"* %Light_Source_Ray, i64 0, i32 1, i64 2, !dbg !6417
  %13 = load double* %arrayidx6.i, align 8, !dbg !6417, !tbaa !2552
  %mul7.i = fmul double %12, %13, !dbg !6417
  %add8.i = fadd double %add.i, %mul7.i, !dbg !6417
  call void @llvm.dbg.value(metadata !{double %add8.i}, i64 0, metadata !1718), !dbg !6417
  call void @llvm.dbg.value(metadata !{double %add8.i}, i64 0, metadata !6418), !dbg !6415
  call void @llvm.dbg.value(metadata !{double %add8.i}, i64 0, metadata !1718), !dbg !6419
  %cmp13 = fcmp olt double %add8.i, 1.000000e-07, !dbg !6419
  br i1 %cmp13, label %cleanup, label %if.end16, !dbg !6419

if.end16:                                         ; preds = %if.end, %if.then11
  %14 = load i32* getelementptr inbounds (%"struct.pov::OPTIONS_STRUCT"* @_ZN3pov4optsE, i64 0, i32 13), align 8, !dbg !6420, !tbaa !2301
  %and18 = and i32 %14, 4, !dbg !6420
  %tobool19 = icmp eq i32 %and18, 0, !dbg !6420
  br i1 %tobool19, label %if.end52, label %land.lhs.true20, !dbg !6420

land.lhs.true20:                                  ; preds = %if.end16
  %Projected_Through_Object = getelementptr inbounds %"struct.pov::Light_Source_Struct"* %Light_Source, i64 0, i32 42, !dbg !6420
  %15 = load %"struct.pov::Object_Struct"** %Projected_Through_Object, align 8, !dbg !6420, !tbaa !2295
  %cmp21 = icmp eq %"struct.pov::Object_Struct"* %15, null, !dbg !6420
  br i1 %cmp21, label %lor.lhs.false, label %if.then24, !dbg !6420

lor.lhs.false:                                    ; preds = %land.lhs.true20
  %Light_Type = getelementptr inbounds %"struct.pov::Light_Source_Struct"* %Light_Source, i64 0, i32 27, !dbg !6420
  %16 = load i8* %Light_Type, align 1, !dbg !6420, !tbaa !2296
  %cmp23 = icmp eq i8 %16, 3, !dbg !6420
  br i1 %cmp23, label %if.end52, label %if.then24, !dbg !6420

if.then24:                                        ; preds = %lor.lhs.false, %land.lhs.true20
  %cmp25 = icmp sgt i32 %Light_Index, -1, !dbg !6421
  br i1 %cmp25, label %if.then26, label %if.else49, !dbg !6421

if.then26:                                        ; preds = %if.then24
  %idxprom = sext i32 %Light_Index to i64, !dbg !6423
  %17 = load %"struct.pov::Light_Tested_Struct"** @_ZN3pov10Light_ListE, align 8, !dbg !6423, !tbaa !2295
  %Tested = getelementptr inbounds %"struct.pov::Light_Tested_Struct"* %17, i64 %idxprom, i32 0, !dbg !6423
  %18 = load i32* %Tested, align 4, !dbg !6423, !tbaa !2301
  %tobool28 = icmp eq i32 %18, 0, !dbg !6423
  br i1 %tobool28, label %if.else, label %if.then29, !dbg !6423

if.then29:                                        ; preds = %if.then26
  %arraydecay34 = getelementptr inbounds %"struct.pov::Light_Tested_Struct"* %17, i64 %idxprom, i32 1, i64 0, !dbg !6425
  tail call void @llvm.dbg.value(metadata !{float* %arraydecay}, i64 0, metadata !6427), !dbg !6428
  tail call void @llvm.dbg.value(metadata !{float* %arraydecay34}, i64 0, metadata !6429), !dbg !6428
  %19 = load float* %arraydecay34, align 4, !dbg !6430, !tbaa !2644
  store float %19, float* %arraydecay, align 16, !dbg !6430, !tbaa !2644
  %arrayidx2.i134 = getelementptr inbounds %"struct.pov::Light_Tested_Struct"* %17, i64 %idxprom, i32 1, i64 1, !dbg !6431
  %20 = load float* %arrayidx2.i134, align 4, !dbg !6431, !tbaa !2644
  %arrayidx3.i135 = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 1, !dbg !6431
  store float %20, float* %arrayidx3.i135, align 4, !dbg !6431, !tbaa !2644
  %arrayidx4.i = getelementptr inbounds %"struct.pov::Light_Tested_Struct"* %17, i64 %idxprom, i32 1, i64 2, !dbg !6432
  %21 = load float* %arrayidx4.i, align 4, !dbg !6432, !tbaa !2644
  %arrayidx5.i136 = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 2, !dbg !6432
  store float %21, float* %arrayidx5.i136, align 8, !dbg !6432, !tbaa !2644
  %arrayidx6.i137 = getelementptr inbounds %"struct.pov::Light_Tested_Struct"* %17, i64 %idxprom, i32 1, i64 3, !dbg !6433
  %22 = load float* %arrayidx6.i137, align 4, !dbg !6433, !tbaa !2644
  %arrayidx7.i = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 3, !dbg !6433
  store float %22, float* %arrayidx7.i, align 4, !dbg !6433, !tbaa !2644
  %arrayidx8.i = getelementptr inbounds %"struct.pov::Light_Tested_Struct"* %17, i64 %idxprom, i32 1, i64 4, !dbg !6434
  %23 = load float* %arrayidx8.i, align 4, !dbg !6434, !tbaa !2644
  %arrayidx9.i = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 4, !dbg !6434
  store float %23, float* %arrayidx9.i, align 16, !dbg !6434, !tbaa !2644
  br label %if.end52, !dbg !6435

if.else:                                          ; preds = %if.then26
  %Type = getelementptr inbounds %"struct.pov::Light_Source_Struct"* %Light_Source, i64 0, i32 1, !dbg !6436
  %24 = load i32* %Type, align 4, !dbg !6436, !tbaa !2301
  %and35 = and i32 %24, 4096, !dbg !6436
  %cmp36 = icmp eq i32 %and35, 0, !dbg !6436
  br i1 %cmp36, label %if.then37, label %if.end52, !dbg !6436

if.then37:                                        ; preds = %if.else
  call void @llvm.dbg.value(metadata !{double* %Light_Source_Depth}, i64 0, metadata !1717), !dbg !6437
  %25 = load double* %Light_Source_Depth, align 8, !dbg !6437, !tbaa !2552
  call fastcc void @_ZN3povL18block_light_sourceEPNS_19Light_Source_StructEdPNS_10Ray_StructES3_PdPf(%"struct.pov::Light_Source_Struct"* %Light_Source, double %25, %"struct.pov::Ray_Struct"* %Light_Source_Ray, %"struct.pov::Ray_Struct"* %Eye, double* %IPoint, float* %arraydecay) #7, !dbg !6437
  %26 = load %"struct.pov::Light_Tested_Struct"** @_ZN3pov10Light_ListE, align 8, !dbg !6439, !tbaa !2295
  %Tested41 = getelementptr inbounds %"struct.pov::Light_Tested_Struct"* %26, i64 %idxprom, i32 0, !dbg !6439
  store i32 1, i32* %Tested41, align 4, !dbg !6439, !tbaa !2301
  %arraydecay45 = getelementptr inbounds %"struct.pov::Light_Tested_Struct"* %26, i64 %idxprom, i32 1, i64 0, !dbg !6440
  tail call void @llvm.dbg.value(metadata !{float* %arraydecay45}, i64 0, metadata !6441), !dbg !6442
  tail call void @llvm.dbg.value(metadata !{float* %arraydecay}, i64 0, metadata !6443), !dbg !6442
  %27 = load float* %arraydecay, align 16, !dbg !6444, !tbaa !2644
  store float %27, float* %arraydecay45, align 4, !dbg !6444, !tbaa !2644
  %arrayidx2.i138 = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 1, !dbg !6445
  %28 = load float* %arrayidx2.i138, align 4, !dbg !6445, !tbaa !2644
  %arrayidx3.i139 = getelementptr inbounds %"struct.pov::Light_Tested_Struct"* %26, i64 %idxprom, i32 1, i64 1, !dbg !6445
  store float %28, float* %arrayidx3.i139, align 4, !dbg !6445, !tbaa !2644
  %arrayidx4.i140 = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 2, !dbg !6446
  %29 = load float* %arrayidx4.i140, align 8, !dbg !6446, !tbaa !2644
  %arrayidx5.i141 = getelementptr inbounds %"struct.pov::Light_Tested_Struct"* %26, i64 %idxprom, i32 1, i64 2, !dbg !6446
  store float %29, float* %arrayidx5.i141, align 4, !dbg !6446, !tbaa !2644
  %arrayidx6.i142 = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 3, !dbg !6447
  %30 = load float* %arrayidx6.i142, align 4, !dbg !6447, !tbaa !2644
  %arrayidx7.i143 = getelementptr inbounds %"struct.pov::Light_Tested_Struct"* %26, i64 %idxprom, i32 1, i64 3, !dbg !6447
  store float %30, float* %arrayidx7.i143, align 4, !dbg !6447, !tbaa !2644
  %arrayidx8.i144 = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 4, !dbg !6448
  %31 = load float* %arrayidx8.i144, align 16, !dbg !6448, !tbaa !2644
  %arrayidx9.i145 = getelementptr inbounds %"struct.pov::Light_Tested_Struct"* %26, i64 %idxprom, i32 1, i64 4, !dbg !6448
  store float %31, float* %arrayidx9.i145, align 4, !dbg !6448, !tbaa !2644
  br label %if.end52, !dbg !6449

if.else49:                                        ; preds = %if.then24
  call void @llvm.dbg.value(metadata !{double* %Light_Source_Depth}, i64 0, metadata !1717), !dbg !6450
  %32 = load double* %Light_Source_Depth, align 8, !dbg !6450, !tbaa !2552
  call fastcc void @_ZN3povL18block_light_sourceEPNS_19Light_Source_StructEdPNS_10Ray_StructES3_PdPf(%"struct.pov::Light_Source_Struct"* %Light_Source, double %32, %"struct.pov::Ray_Struct"* %Light_Source_Ray, %"struct.pov::Ray_Struct"* %Eye, double* %IPoint, float* %arraydecay) #7, !dbg !6450
  br label %if.end52

if.end52:                                         ; preds = %lor.lhs.false, %if.end16, %if.else49, %if.else, %if.then37, %if.then29
  %33 = load float* %arraydecay, align 16, !dbg !6452, !tbaa !2644
  %fabsf129 = call float @fabsf(float %33) #4, !dbg !6452
  %34 = fpext float %fabsf129 to double, !dbg !6452
  %cmp56 = fcmp ogt double %34, 1.000000e-07, !dbg !6452
  br i1 %cmp56, label %if.then67, label %lor.lhs.false57, !dbg !6452

lor.lhs.false57:                                  ; preds = %if.end52
  %arrayidx58 = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 1, !dbg !6453
  %35 = load float* %arrayidx58, align 4, !dbg !6453, !tbaa !2644
  %fabsf130 = call float @fabsf(float %35) #4, !dbg !6453
  %36 = fpext float %fabsf130 to double, !dbg !6453
  %cmp61 = fcmp ogt double %36, 1.000000e-07, !dbg !6453
  br i1 %cmp61, label %if.then67, label %lor.lhs.false62, !dbg !6453

lor.lhs.false62:                                  ; preds = %lor.lhs.false57
  %arrayidx63 = getelementptr inbounds [5 x float]* %Light_Colour, i64 0, i64 2, !dbg !6454
  %37 = load float* %arrayidx63, align 8, !dbg !6454, !tbaa !2644
  %fabsf131 = call float @fabsf(float %37) #4, !dbg !6454
  %38 = fpext float %fabsf131 to double, !dbg !6454
  %cmp66 = fcmp ogt double %38, 1.000000e-07, !dbg !6454
  br i1 %cmp66, label %if.then67, label %cleanup, !dbg !6454

if.then67:                                        ; preds = %lor.lhs.false62, %lor.lhs.false57, %if.end52
  %Diffuse = getelementptr inbounds %"struct.pov::Finish_Struct"* %Finish, i64 0, i32 0, !dbg !6455
  %39 = load float* %Diffuse, align 4, !dbg !6455, !tbaa !2644
  %cmp69 = fcmp ogt float %39, 0.000000e+00, !dbg !6455
  br i1 %cmp69, label %if.then70, label %if.end72, !dbg !6455

if.then70:                                        ; preds = %if.then67
  call void @_ZN3pov10do_diffuseEPNS_13Finish_StructEPNS_10Ray_StructEPdPfS5_S5_d(%"struct.pov::Finish_Struct"* %Finish, %"struct.pov::Ray_Struct"* %Light_Source_Ray, double* %Layer_Normal, float* %Colour, float* %arraydecay, float* %Layer_Pigment_Colour, double %Attenuation) #7, !dbg !6457
  br label %if.end72, !dbg !6459

if.end72:                                         ; preds = %if.then67, %if.then70
  %Light_Type73 = getelementptr inbounds %"struct.pov::Light_Source_Struct"* %Light_Source, i64 0, i32 27, !dbg !6460
  %40 = load i8* %Light_Type73, align 1, !dbg !6460, !tbaa !2296
  %cmp75 = icmp ne i8 %40, 3, !dbg !6460
  %41 = load i32* @_ZN3pov21Radiosity_Trace_LevelE, align 4, !dbg !6460, !tbaa !2301
  %cmp77 = icmp slt i32 %41, 2, !dbg !6460
  %or.cond = and i1 %cmp75, %cmp77, !dbg !6460
  br i1 %or.cond, label %if.then78, label %if.end91, !dbg !6460

if.then78:                                        ; preds = %if.end72
  %Phong = getelementptr inbounds %"struct.pov::Finish_Struct"* %Finish, i64 0, i32 4, !dbg !6461
  %42 = load float* %Phong, align 4, !dbg !6461, !tbaa !2644
  %cmp80 = fcmp ogt float %42, 0.000000e+00, !dbg !6461
  br i1 %cmp80, label %if.then81, label %if.end85, !dbg !6461

if.then81:                                        ; preds = %if.then78
  %arraydecay83 = getelementptr inbounds %"struct.pov::Ray_Struct"* %Eye, i64 0, i32 1, i64 0, !dbg !6463
  call void @_ZN3pov8do_phongEPNS_13Finish_StructEPNS_10Ray_StructEPdS4_PfS5_S5_(%"struct.pov::Finish_Struct"* %Finish, %"struct.pov::Ray_Struct"* %Light_Source_Ray, double* %arraydecay83, double* %Layer_Normal, float* %Colour, float* %arraydecay, float* %Layer_Pigment_Colour) #7, !dbg !6463
  br label %if.end85, !dbg !6465

if.end85:                                         ; preds = %if.then81, %if.then78
  %Specular = getelementptr inbounds %"struct.pov::Finish_Struct"* %Finish, i64 0, i32 2, !dbg !6466
  %43 = load float* %Specular, align 4, !dbg !6466, !tbaa !2644
  %cmp87 = fcmp ogt float %43, 0.000000e+00, !dbg !6466
  br i1 %cmp87, label %if.then88, label %if.end91, !dbg !6466

if.then88:                                        ; preds = %if.end85
  call void @_ZN3pov11do_specularEPNS_13Finish_StructEPNS_10Ray_StructEPdS4_PfS5_S5_(%"struct.pov::Finish_Struct"* %Finish, %"struct.pov::Ray_Struct"* %Light_Source_Ray, double* %REye, double* %Layer_Normal, float* %Colour, float* %arraydecay, float* %Layer_Pigment_Colour) #7, !dbg !6467
  br label %if.end91, !dbg !6469

if.end91:                                         ; preds = %if.end85, %if.then88, %if.end72
  %Irid = getelementptr inbounds %"struct.pov::Finish_Struct"* %Finish, i64 0, i32 6, !dbg !6470
  %44 = load float* %Irid, align 4, !dbg !6470, !tbaa !2644
  %cmp93 = fcmp ogt float %44, 0.000000e+00, !dbg !6470
  br i1 %cmp93, label %if.then94, label %cleanup, !dbg !6470

if.then94:                                        ; preds = %if.end91
  call fastcc void @_ZN3povL7do_iridEPNS_13Finish_StructEPNS_10Ray_StructEPdS4_Pf(%"struct.pov::Finish_Struct"* %Finish, %"struct.pov::Ray_Struct"* %Light_Source_Ray, double* %Layer_Normal, double* %IPoint, float* %Colour) #7, !dbg !6471
  br label %cleanup, !dbg !6473

cleanup:                                          ; preds = %lor.lhs.false62, %if.then94, %if.end91, %if.then11, %land.lhs.true5
  call void @llvm.lifetime.end(i64 856, i8* %0) #6, !dbg !6474
  ret void, !dbg !6475
}
